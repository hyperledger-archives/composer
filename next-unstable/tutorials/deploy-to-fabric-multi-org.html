<!doctype html>
<html lang="en">
  
  
  

<head>
  <meta charset="utf-8">
  
    <title>Deploying to a multi-organization Hyperledger Fabric | Hyperledger Composer</title>
  
  <meta name="viewport" content="width=device-width">
  <link rel="icon" type="image/x-icon" href="/composer/next-unstable/favicon.ico">
  <meta name="google-site-verification" content="fBQRJ6h7MV7_TJ7grbgq4P-d-07NRfDWPe4pqEEoH5w">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  
    <!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-91314349-2', 'auto');
ga('require', 'outboundLinkTracker');
ga('require', 'eventTracker');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script async src="/composer/next-unstable/assets/js/autotrack.js"></script>
<!-- End Google Analytics -->

  

  
    <link href="/composer/next-unstable/assets/css/normalize.css" rel="stylesheet">
    <link href="/composer/next-unstable/assets/css/new-style.min.css" rel="stylesheet">
    <link href="/composer/next-unstable/assets/css/grid-layout.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>
  
</head>


<body class="">

  
  <!-- % include navbar.html % -->
  

  <div class="SiteWrapper">
    
      <div class="content">
    <article class="docs-container">
        <!-- If there's a sidebar, divide into 2 columns -->
        
        <div class="page-sidebar-grid" id="off-canvas">
          <!-- <a class="toggle close" href="#">close</a> -->
          <div class="docs-pagenav-grid">
            <!-- Navigation -->
  <nav class="navbar-docs" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
            <a class="navbar-brand" href="/composer/next-unstable/index.html"><b>Hyperledger</b> Composer</a>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <div class="top-nav-docs">
                <!-- <li>
                    <a href="services.html">Composer</a>
                </li> -->
                <!-- <li>
                    <a href="https://composer-playground.mybluemix.net/">Playground</a>
                </li> -->
                    <a href="../tutorials/tutorials.html">Tutorials</a>
                    <a href="../introduction/introduction.html">Docs</a>
                    <a href="../support/support-index.html">Community</a>
            </div>
        </div>
</nav>

          </div>

            <div class="search-form">
              <form action="/composer/next-unstable/search/search.html" method="get">
                <!-- <label for="search-box">Search</label> -->

                <input type="text" id="search-box"  class="search-box" name="query" placeholder="Search here...">
                <input type="submit" class="submit-input hide" value="">

                <div class="search-icon">
                  <img src="/composer/next-unstable/assets/img/Search_Icon_1.svg" class="trigger" type="submit">
                </div>
              </form>
            </div>

          <div class="docs-current-page-grid">
          <p>Deploying to a multi-organization Hyperledger Fabric</p>
          </div>

          <nav class="context-nav">
            
            
              <ul>
<li><p><a href="/composer/next-unstable/introduction/introduction"><b>Introduction</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/composer/next-unstable/introduction/key-concepts">Key Concepts</a></li>
<li><a href="/composer/next-unstable/introduction/solution-architecture">Typical Solution Architecture</a></li>
</ul></li>
<li><p><a href="/composer/next-unstable/installing/installing-index"><b>Installing</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/composer/next-unstable/installing/installing-prereqs">Installing pre-requisites</a></li>
<li><a href="/composer/next-unstable/installing/development-tools">Installing the development environment</a></li>
</ul></li>
<li><p><a href="/composer/next-unstable/tutorials/tutorials"><b>Tutorials</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/composer/next-unstable/tutorials/playground-tutorial">Playground Tutorial</a></li>
<li><a href="/composer/next-unstable/tutorials/developer-tutorial">Developer Tutorial</a></li>
<li><a href="/composer/next-unstable/tutorials/queries">Queries Tutorial</a></li>
<li><a href="/composer/next-unstable/tutorials/deploy-to-fabric-single-org">Deploying to a single organization Hyperledger Fabric</a></li>
<li><a href="/composer/next-unstable/tutorials/deploy-to-fabric-multi-org">Deploying to a multi-organization Hyperledger Fabric</a></li>
<li><a href="/composer/next-unstable/tutorials/invoke-composer-network">Invoking a Composer business network from another business network using Hyperledger Fabric</a></li>
<li><a href="/composer/next-unstable/tutorials/acl-trading">Access Control Tutorial - Commodity Trading</a></li>
</ul></li>
<li><p><a href="/composer/next-unstable/playground/playground-index"><b>Using Playground</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/composer/next-unstable/playground/id-cards-playground">Business Network Cards</a></li>
</ul></li>
<li><p><a href="/composer/next-unstable/business-network/business-network-index"><b>Developing Business Networks</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/composer/next-unstable/business-network/businessnetworkdefinition">Business Network Definitions</a></li>
<li><a href="/composer/next-unstable/business-network/bnd-create">Create a Business Network Definition</a></li>
<li><a href="/composer/next-unstable/business-network/bnd-deploy">Deploying Business Networks</a></li>
<li><a href="/composer/next-unstable/business-network/publishing-events">Emitting Events</a></li>
<li><a href="/composer/next-unstable/business-network/testing">Testing Business Networks</a></li>
<li><a href="/composer/next-unstable/business-network/bnd-publish">Publish Models or Business Network Definitions</a></li>
<li><a href="/composer/next-unstable/business-network/query">Using Queries and Filters with Business Network Data</a></li>
<li><a href="/composer/next-unstable/business-network/programmatic-access-control">Programmatic access control</a></li>
<li><a href="/composer/next-unstable/business-network/historian">Hyperledger Composer Historian</a></li>
<li><a href="/composer/next-unstable/business-network/cloud-wallets">Customising card stores</a></li>
</ul></li>
<li><p><a href="/composer/next-unstable/applications/applications-index"><b>Developing Applications</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/composer/next-unstable/applications/node">Writing a Node.js application</a></li>
<li><a href="/composer/next-unstable/applications/web">Writing Web applications</a></li>
<li><a href="/composer/next-unstable/applications/subscribing-to-events">Subscribing to events</a></li>
</ul></li>
<li><p><a href="/composer/next-unstable/integrating/integrating-index"><b>Integrating Existing Systems</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/composer/next-unstable/integrating/getting-started-rest-api">Generating a REST API</a></li>
<li><a href="/composer/next-unstable/integrating/publishing-events">Publishing events from the REST server</a></li>
<li><a href="/composer/next-unstable/integrating/enabling-rest-authentication">Enabling authentication for the REST server</a></li>
<li><a href="/composer/next-unstable/integrating/enabling-multiuser">Enabling multiple user mode for the REST server</a></li>
<li><a href="/composer/next-unstable/integrating/securing-the-rest-server">Securing the REST server using HTTPS and TLS</a></li>
<li><a href="/composer/next-unstable/integrating/deploying-the-rest-server">Deploying the REST server for a business network</a></li>
<li><a href="/composer/next-unstable/integrating/node-red">Integrating with Node-RED</a></li>
<li><a href="/composer/next-unstable/integrating/call-out">Calling external REST services</a></li>
</ul></li>
<li><p><a href="/composer/next-unstable/managing/managingindex"><b>Managing a Deployed Business Network</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/composer/next-unstable/managing/participantsandidentities">Participants and identities</a></li>
<li><a href="/composer/next-unstable/managing/participant-add">Adding participants</a></li>
<li><a href="/composer/next-unstable/managing/id-cards-playground">Creating, Exporting, and Importing Business Network Cards</a></li>
<li><a href="/composer/next-unstable/managing/identity-issue">Issuing a new identity to a participant</a></li>
<li><a href="/composer/next-unstable/managing/identity-bind">Binding an existing identity to a participant</a></li>
<li><a href="/composer/next-unstable/managing/identity-list">Listing all identities in a business network</a></li>
<li><a href="/composer/next-unstable/managing/identity-revoke">Revoking an identity from a participant</a></li>
<li><a href="/composer/next-unstable/managing/updating-composer">Updating the Hyperledger Composer Runtime</a></li>
<li><a href="/composer/next-unstable/managing/connector-information">Interacting with Hyperledger Fabric</a></li>
</ul></li>
<li><p><a href="/composer/next-unstable/problems/diagnostics"><b>Diagnosing Problems</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p></li>
<li><p><a href="/composer/next-unstable/reference/reference-index"><b>Reference</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/composer/next-unstable/reference/MeetTheModules">Hyperledger Composer npm Modules</a></li>
<li><a href="/composer/next-unstable/reference/cto_language">Modeling Language</a></li>
<li><a href="/composer/next-unstable/reference/acl_language">Access Control Language</a></li>
<li><a href="/composer/next-unstable/reference/query-language">Query Language</a></li>
<li><a href="/composer/next-unstable/reference/model-compatibility">Model Compatibility</a></li>
<li><a href="/composer/next-unstable/reference/connectionprofile">Connection Profiles</a></li>
<li><a href="/composer/next-unstable/reference/js_scripts">Transaction Processor Functions</a></li>
<li><a href="/composer/next-unstable/reference/commands">Hyperledger Composer CLI Commands</a></li>
<li><a href="/composer/next-unstable/reference/rest-server">Hyperledger Composer REST Server</a></li>
<li><a href="/composer/next-unstable/reference/glossary">Hyperledger Composer Glossary of Terms</a></li>
</ul></li>
<li><p><a href="/composer/next-unstable/support/support-index"><b>Support</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p></li>
<li><p><a href="/composer/next-unstable/api/api-doc-index"><b>API Reference</b><img src="/composer/next-unstable/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/composer/next-unstable/api/allData">API Class Index</a></li>
<li><a href="/composer/next-unstable/api/admin-adminconnection">AdminConnection (Admin API)</a></li>
<li><a href="/composer/next-unstable/api/client-assetregistry">AssetRegistry (Client API)</a></li>
<li><a href="/composer/next-unstable/api/client-businessnetworkconnection">BusinessNetworkConnection (Client API)</a></li>
<li><a href="/composer/next-unstable/api/client-historian">Historian (Client API)</a></li>
<li><a href="/composer/next-unstable/api/client-identityregistry">IdentityRegistry (Client API)</a></li>
<li><a href="/composer/next-unstable/api/client-participantregistry">ParticipantRegistry (Client API)</a></li>
<li><a href="/composer/next-unstable/api/client-query">Query (Client API)</a></li>
<li><a href="/composer/next-unstable/api/client-registry">Registry (Client API)</a></li>
<li><a href="/composer/next-unstable/api/client-transactionregistry">TransactionRegistry (Client API)</a></li>
<li><a href="/composer/next-unstable/api/common-assetdeclaration">AssetDeclaration (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-businessnetworkcardstore">BusinessNetworkCardStore (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-businessnetworkdefinition">BusinessNetworkDefinition (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-businessnetworkmetadata">BusinessNetworkMetadata (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-classdeclaration">ClassDeclaration (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-conceptdeclaration">ConceptDeclaration (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-concept">Concept (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-enumdeclaration">EnumDeclaration (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-enumvaluedeclaration">EnumValueDeclaration (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-eventdeclaration">EventDeclaration (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-factory">Factory (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-functiondeclaration">FunctionDeclaration (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-idcard">IdCard (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-identifiable">Identifiable (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-introspector">Introspector (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-modelfile">ModelFile (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-modelmanager">ModelManager (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-participantdeclaration">ParticipantDeclaration (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-property">Property (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-relationshipdeclaration">RelationshipDeclaration (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-relationship">Relationship (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-resource">Resource (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-serializer">Serializer (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-transactiondeclaration">TransactionDeclaration (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-typed">Typed (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-validatedconcept">ValidatedConcept (Common API)</a></li>
<li><a href="/composer/next-unstable/api/common-validatedresource">ValidatedResource (Common API)</a></li>
<li><a href="/composer/next-unstable/api/runtime-api">Api (Runtime API)</a></li>
<li><a href="/composer/next-unstable/api/runtime-assetregistry">AssetRegistry (Runtime API)</a></li>
<li><a href="/composer/next-unstable/api/runtime-factory">Factory (Runtime API)</a></li>
<li><a href="/composer/next-unstable/api/runtime-participantregistry">ParticipantRegistry (Runtime API)</a></li>
<li><a href="/composer/next-unstable/api/runtime-query">Query (Runtime API)</a></li>
<li><a href="/composer/next-unstable/api/runtime-serializer">Serializer (Runtime API)</a></li>
</ul></li>
</ul>

            
                <div class="docs-footer-grid">
                <div class="footer-bg-break docs-footer-break">
<div class="footer-container-break">
    <div class="footer-left-break">
      <p>Released under the Apache License v2.0</p>
    </div>
  <div class="footer-right-break">
    <ul>
      <li><a href="https://github.com/hyperledger/composer">GitHub</a></li>
      <li><a href="http://stackoverflow.com/questions/tagged/fabric-composer">Stack Overflow</a></li>
      
      <li><a href="https://hyperledger.github.io/composer/latest">Latest (Unstable) Docs</a></li>
      <li><a href="https://hyperledger.github.io/composer/stable">Stable (Supported) Docs</a></li>
           
    </ul>
  </div>
</div>
</div>

                </div>
          </nav>
        </div>
        <div class="page-content-grid">
          <section class="content-chunk">
            <!-- <a class="toggle open" href="#nav">open</a> -->
            
              <h1 id="deploying-a-hyperledger-composer-blockchain-business-network-to-hyperledger-fabric-multiple-organizations">Deploying a Hyperledger Composer blockchain business network to Hyperledger Fabric (multiple organizations)</h1>

<p>This tutorial provides an insight into the process for configuring a blockchain network, spanning multiple organizations.</p>

<p>It outlines the steps you need configure an Hyperledger Fabric based multi-organisation blockchain network. The two-organisation blockchain network is based on a sample network provided by Hyperledger Fabric. Furthermore, it describes the steps to generate the necessary security artifacts and secure the network in either organization. </p>

<p>Once the blockchain network is configured, we show how to deploy a business network (eg. a Commodity trading business network from our sample networks), which runs in its own chaincode container and which is instantiated on the ledger shared across both organizations. We then show interactions with the shared ledger as different participants / identities, as generated by an Identity provider in each organization.</p>

<p>It is recommended that you first follow the accompanying singie organization tutorial first ; this tutorial demonstrates how to deploy a blockchain network to an instance of Hyperledger Fabric for a single organization, and will explain some of the concepts in more detail.</p>

<p>The {site.data.conrefs.hlf_full}} blockchain network (for two organizations) in this tutorial is configured using docker containers,  with both organizations&#39; fabric networks, on the same machine - obviously, in the real world, they&#39;ll be in separate IP networks or domains, or secure Cloud environments. </p>

<p>The tutorial has colour-coded steps for convenience, to indicate &#39;which organization&#39; should follow a particular step or sequence - or indeed, if steps are needed for both Orgs.</p>

<p>The first kind of step is for both organizations to follow:</p>

<h2 class='everybody'>Example Step: A step for Org1 and Org2 to follow</h2>

<p>The organization <code>Org1</code> is represented by Alice, the Green Conga Block:</p>

<h2 class='alice'>Example Step: A step for Org1 to follow</h2>

<p>The organization <code>Org2</code> is represented by Bob, the Violet Conga Block:</p>

<h2 class='bob'>Example Step: A step for Org2 to follow</h2>

<p>You can follow these steps by yourself, or pair with a friend or colleague and follow the steps together.</p>

<p>Let&#39;s get started!</p>

<h2 class='everybody'>Prerequisites</h2>

<p>If you have previously installed the Composer development environment, you will need to first tear down the Hyperledger Fabric containers provided by the development environment:</p>
<div class="highlight"><pre><code class="language-" data-lang="">cd ~/fabric-tools
./stopFabric.sh
./teardownFabric.sh
</code></pre></div>
<p>Next, clone the following GitHub Fabric Samples repository using the command line (do not use the samples from the <a href="http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html">Fabric site:</a> as it is missing some changes that are required for this tutorial)</p>
<div class="highlight"><pre><code class="language-" data-lang="">git clone -b issue-6978 https://github.com/sstone1/fabric-samples.git
</code></pre></div>
<p>We are using the  <a href="http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html">Building Your First Network</a> Fabric sample network for this multi-org tutorial. We will refer to this Hyperledger Fabric network as the &#39;BYFN&#39; (Building Your First Network) network henceforth. If you choose to split your organisations across separate physical machines or separate virtual machines running on different IP networks, it is outside the scope of this particular tutorial. </p>

<h2 class='everybody'>Step One: Starting a Hyperledger Fabric network</h2>

<p>In order to follow this tutorial, you must start up a fresh Hyperledger Fabric network. This tutorial will assume that you use the Hyperledger Fabric network provided in the Hyperledger Fabric <a href="http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html">Building Your First Network tutorial</a>. </p>

<ol>
<li><p>change directory to <code>fabric-samples</code></p>
<div class="highlight"><pre><code class="language-" data-lang="">cd fabric-samples
</code></pre></div></li>
<li><p>Download the platform binaries, including cryptogen :</p>
<div class="highlight"><pre><code class="language-" data-lang="">curl -sSL https://goo.gl/6wtTN5 | bash -s 1.1.0-alpha
</code></pre></div>
<p>Verify the list of docker images downloaded without issues</p></li>
<li><p>change directory into <code>first-network</code> sample </p>
<div class="highlight"><pre><code class="language-" data-lang="">cd first-network
</code></pre></div></li>
<li><p>Next, start the BYFN network - additional flags (to the <code>byfn.sh</code> script below) must be specified, as we&#39;re using CouchDB as the world state database (different to that specified on the Fabric BYFN page) - we also want to start a Certificate Authority (CA) for <strong>each</strong> organization.</p></li>
<li><p>Execute the following commands in sequence from the <code>first-network</code> directory:</p>
<div class="highlight"><pre><code class="language-" data-lang="">./byfn.sh -m generate

./byfn.sh -m up -s couchdb -a
</code></pre></div></li>
</ol>

<p>If the command works successfully, the first command will generate Fabric network / security artifacts(see this <a href="http://hyperledger-fabric.readthedocs.io/en/release/build_network.html#generate-network-artifacts%20for%20more%20info">link</a>. Following the second command (above), the BYFN network is started, and verify that you see the following output before proceeding:</p>
<div class="highlight"><pre><code class="language-" data-lang="">========= All GOOD, BYFN execution completed ===========


_____   _   _   ____
| ____| | \ | | |  _ \
|  _|   |  \| | | | | |
| |___  | |\  | | |_| |
|_____| |_| \_| |____/
</code></pre></div>
<p>Next, delete any &#39;old&#39; business network cards that may exist in your wallet from previous Fabric environments. It is safe to ignore any errors that state that the business network cards cannot be found:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer card delete -n PeerAdmin@byfn-network-org1
composer card delete -n PeerAdmin@byfn-network-org2
composer card delete -n alice@trade-network
composer card delete -n bob@trade-network
composer card delete -n admin@trade-network
composer card delete -n PeerAdmin@fabric-network
</code></pre></div>
<p>However any other types of failure could indicate you have cards in the card store which are from an older version of Hyperledger Composer and you will then have to delete your file system card store in your HOME directory as follows:</p>
<div class="highlight"><pre><code class="language-" data-lang="">rm -fr $HOME/.composer 
</code></pre></div>
<h2 class='everybody'>Step Two: Exploring the Hyperledger Fabric network</h2>

<p>This step will explore the BFYN network configuration and components. The configuration details are required to complete the subsequent steps.</p>

<h4 id="organizations">Organizations</h4>

<p>The BYFN network is made up of two organizations: <code>Org1</code> and <code>Org2</code>. The organization <code>Org1</code> uses the domain name <code>org1.example.com</code>. The Membership Services Provider (MSP) for <code>Org1</code> is called <code>Org1MSP</code>. The organization <code>Org2</code> uses the domain name <code>org2.example.com</code>. The MSP for <code>Org2</code> is called <code>Org2MSP</code>. In this tutorial, you will deploy a blockchain business network that both of the organizations <code>Org1</code> and <code>Org2</code> can interact with.</p>

<h4 id="network-components">Network components</h4>

<p>The Hyperledger Fabric network is made up of several components:</p>

<ul>
<li>Two peer nodes for <code>Org1</code>, named <code>peer0.org1.example.com</code> and <code>peer1.org1.example.com</code>.

<ul>
<li>The request port for <code>peer0</code> is 7051.</li>
<li>The event hub port for <code>peer0</code> is 7053.</li>
<li>The request port for <code>peer1</code> is 8051.</li>
<li>The event hub port for <code>peer1</code> is 8053.</li>
</ul></li>
<li>A single CA (Certificate Authority) for <code>Org1</code>, named <code>ca.org1.example.com</code>.

<ul>
<li>The CA port is 7054.</li>
</ul></li>
<li>Two peer nodes for <code>Org2</code>, named <code>peer0.org2.example.com</code> and <code>peer1.org2.example.com</code>.

<ul>
<li>The request port for <code>peer0</code> is 9051.</li>
<li>The event hub port for <code>peer0</code> is 9053.</li>
<li>The request port for <code>peer1</code> is 10051.</li>
<li>The event hub port for <code>peer1</code> is 10053.</li>
</ul></li>
<li>A single CA (Certificate Authority) for <code>Org2</code>, named <code>ca.org2.example.com</code>.

<ul>
<li>The CA port is 8054.</li>
</ul></li>
<li>A single orderer node, named <code>orderer.example.com</code>.

<ul>
<li>The orderer port is 7050.</li>
</ul></li>
</ul>

<p>These components are running inside Docker containers. When running Hyperledger Composer within a Docker container, the names above (for example, <code>peer0.org1.example.com</code>) can be used to interact with the Hyperledger Fabric network.</p>

<p>This tutorial will run Hyperledger Composer commands on the Docker host machine, rather than from inside the Docker network. This means that the Hyperledger Composer commands must interact with the Hyperledger Fabric network using <code>localhost</code> as the host name and the exposed container ports.</p>

<p>All of the network components are secured using TLS to encrypt communications. You will need the Certificate Authority (CA) certificates for all of the network components in order to connect to those network components. The CA certificates can be found in the directory containing the byfn.sh script.</p>

<p>CA certificate for the orderer node:</p>
<div class="highlight"><pre><code class="language-" data-lang="">crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt
</code></pre></div>
<p>CA certificate for <code>Org1</code>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
</code></pre></div>
<p>CA certificate for <code>Org2</code>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
</code></pre></div>
<p>You will use these files later on to interact with the Hyperledger Fabric network.</p>

<h4 id="users">Users</h4>

<p>The organization <code>Org1</code> is configured with a user named <code>Admin@org1.example.com</code>. This user is an administrator.</p>

<p>The user <code>Admin@org1.example.com</code> has a set of certificates and private key files stored in the directory:</p>
<div class="highlight"><pre><code class="language-" data-lang="">crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
</code></pre></div>
<p>The organization <code>Org2</code> is configured with a user named <code>Admin@org2.example.com</code>. This user is an administrator.</p>

<p>The user <code>Admin@org2.example.com</code> has a set of certificates and private key files stored in the directory:</p>
<div class="highlight"><pre><code class="language-" data-lang="">crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
</code></pre></div>
<p>You will use some of these files later on to interact with the Hyperledger Fabric network.</p>

<p>In addition to the administrator, the CAs (Certificate Authorities) for <code>Org1</code> and <code>Org2</code> have been configured with a default user. This default user has an enrolment ID of <code>admin</code> and an enrolment secret of <code>adminpw</code>. However, this user does not have permission to deploy a blockchain business network.</p>

<p>It is recommended to create a temporary working directory (and subdirectories) to manage the Composer connection profiles and key/certificate files that we will work with later on in the tutorial.</p>
<div class="highlight"><pre><code class="language-" data-lang="">mkdir -p /tmp/composer/org1

mkdir -p /tmp/composer/org2
</code></pre></div>
<h4 id="channel">Channel</h4>

<p>A channel named <code>mychannel</code> has been created. All four peer nodes - <code>peer0.org1.example.com</code>, <code>peer1.org1.example.com</code>, <code>peer0.org2.example.com</code>, and <code>peer1.org2.example.com</code> have been joined to this channel.</p>

<h4 id="connection-profiles">Connection Profiles</h4>

<p>We need a base connection profile that describes this fabric network which can then be given to <code>alice</code> and <code>bob</code> to customize for their organization.</p>
<div class="highlight"><pre><code class="language-" data-lang="">{
    "name": "byfn-network",
    "x-type": "hlfv1",
    "version": "1.0.0",
    "channels": {
        "mychannel": {
            "orderers": [
                "orderer.example.com"
            ],
            "peers": {
                "peer0.org1.example.com": {
                    "endorsingPeer": true,
                    "chaincodeQuery": true,
                    "eventSource": true
                },
                "peer1.org1.example.com": {
                    "endorsingPeer": true,
                    "chaincodeQuery": true,
                    "eventSource": true
                },
                "peer0.org2.example.com": {
                    "endorsingPeer": true,
                    "chaincodeQuery": true,
                    "eventSource": true
                },
                "peer1.org2.example.com": {
                    "endorsingPeer": true,
                    "chaincodeQuery": true,
                    "eventSource": true
                }
            }
        }
    },
    "organizations": {
        "Org1": {
            "mspid": "Org1MSP",
            "peers": [
                "peer0.org1.example.com",
                "peer1.org1.example.com"
            ],
            "certificateAuthorities": [
                "ca.org1.example.com"
            ]
        },
        "Org2": {
            "mspid": "Org2MSP",
            "peers": [
                "peer0.org2.example.com",
                "peer1.org2.example.com"
            ],
            "certificateAuthorities": [
                "ca.org2.example.com"
            ]
        }
    },
    "orderers": {
        "orderer.example.com": {
            "url": "grpcs://localhost:7050",
            "grpcOptions": {
                "ssl-target-name-override": "orderer.example.com"
            },
            "tlsCACerts": {
                "pem": "INSERT_ORDERER_CA_CERT"
            }
        }
    },
    "peers": {
        "peer0.org1.example.com": {
            "url": "grpcs://localhost:7051",
            "eventUrl": "grpcs://localhost:7053",
            "grpcOptions": {
                "ssl-target-name-override": "peer0.org1.example.com"
            },
            "tlsCACerts": {
                "pem": "INSERT_ORG1_CA_CERT"
            }
        },
        "peer1.org1.example.com": {
            "url": "grpcs://localhost:8051",
            "eventUrl": "grpcs://localhost:8053",
            "grpcOptions": {
                "ssl-target-name-override": "peer1.org1.example.com"
            },
            "tlsCACerts": {
                "pem": "INSERT_ORG1_CA_CERT"
            }
        },
        "peer0.org2.example.com": {
            "url": "grpcs://localhost:9051",
            "eventUrl": "grpcs://localhost:9053",
            "grpcOptions": {
                "ssl-target-name-override": "peer0.org2.example.com"
            },
            "tlsCACerts": {
                "pem": "INSERT_ORG2_CA_CERT"
            }
        },
        "peer1.org2.example.com": {
            "url": "grpcs://localhost:10051",
            "eventUrl": "grpcs://localhost:10053",
            "grpcOptions": {
                "ssl-target-name-override": "peer1.org2.example.com"
            },
            "tlsCACerts": {
                "pem": "INSERT_ORG2_CA_CERT"
            }
        }
    },
    "certificateAuthorities": {
        "ca.org1.example.com": {
            "url": "https://localhost:7054",
            "caName": "ca-org1",
            "httpOptions": {
                "verify": false
            }
        },
        "ca.org2.example.com": {
            "url": "https://localhost:8054",
            "caName": "ca-org2",
            "httpOptions": {
                "verify": false
            }
        }
    }
}
</code></pre></div>
<p>Copy this base file (above) into a new file  <code>byfn-network.json</code> under the new directory <code>/tmp/composer</code> and save it. </p>

<p>Open <code>byfn-network.json</code> and replace all instances of the text <code>INSERT_ORG1_CA_CERT</code> with the CA certificate for the peer nodes for <code>Org1</code>: - use the following command to get the certificate from the .pem file so that it can be embedded into the above connection profile.</p>
<div class="highlight"><pre><code class="language-" data-lang="">awk 'NF {sub(/\r/, ""); printf "%s\\n",$0;}' crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt &gt; /tmp/composer/org1/ca-org1.txt
</code></pre></div>
<p>Copy the contents of the file <code>/tmp/composer/org1/ca-org1.txt</code> and replace the text <code>INSERT_ORG1_CA_CERT</code> in the .json file. It should now look something like this (must be a single line in the profile file as shown)</p>
<div class="highlight"><pre><code class="language-" data-lang="">"pem": "-----BEGIN CERTIFICATE-----\nMIICNTCCAdygAwIBAgIRAMNvmQpnXi7uM19BLdha3MwwCgYIKoZIzj0EAwIwbDEL\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\ncmFuY2lzY28xFDASBgNVBAoTC2V4YW1wbGUuY29tMRowGAYDVQQDExF0bHNjYS5l\neGFtcGxlLmNvbTAeFw0xNzA2MjYxMjQ5MjZaFw0yNzA2MjQxMjQ5MjZaMGwxCzAJ\nBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1TYW4gRnJh\nbmNpc2NvMRQwEgYDVQQKEwtleGFtcGxlLmNvbTEaMBgGA1UEAxMRdGxzY2EuZXhh\nbXBsZS5jb20wWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASJn3QUVcKCp+s6lSPE\nP5KlWmE9rEG0kpECsAfW28vZQSIg2Ez+Tp1alA9SYN/5BtL1N6lUUoVhG3lz8uvi\n8zhro18wXTAOBgNVHQ8BAf8EBAMCAaYwDwYDVR0lBAgwBgYEVR0lADAPBgNVHRMB\nAf8EBTADAQH/MCkGA1UdDgQiBCB7ULYTq3+BQqnzwae1RsnwQgJv/HQ5+je2xcDr\nka4MHTAKBggqhkjOPQQDAgNHADBEAiB2hLiS8B1g4J5Qbxu15dVWAZTAXX9xPAvm\n4l25e1oS+gIgBiU/aBwSxY0uambwMB6xtQz0ZE/D4lyTZZcW9SODlOE=\n-----END CERTIFICATE-----\n"
</code></pre></div>
<p>In the same .json file - you need to replace all instances of the text <code>INSERT_ORG2_CA_CERT</code> with the CA certificate for the peer nodes for <code>Org2</code>:  - use the following command to convert the .pem file to something that can be embedded into the above connection profile.</p>
<div class="highlight"><pre><code class="language-" data-lang="">awk 'NF {sub(/\r/, ""); printf "%s\\n",$0;}' crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt &gt; /tmp/composer/org2/ca-org2.txt
</code></pre></div>
<p>Copy the contents of the file <code>/tmp/composer/org2/ca-org2.txt</code> and replace the text called <code>INSERT_ORG2_CA_CERT</code>. Once again, all on the same line.</p>

<p>Replace all instances of the text <code>INSERT_ORDERER_CA_CERT</code> with the CA certificate for the orderer node:  use the following command to convert the .pem file to something that can be embedded into the above connection profile json file.</p>
<div class="highlight"><pre><code class="language-" data-lang="">awk 'NF {sub(/\r/, ""); printf "%s\\n",$0;}' crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt &gt; /tmp/composer/ca-orderer.txt
</code></pre></div>
<p>Copy the contents of the file <code>/tmp/composer/ca-orderer.txt</code>  and replace the text <code>INSERT_ORDERER_CA_CERT</code>. Once again, all on the same line.</p>

<p>Once done, save this file as  <code>/tmp/composer/byfn-network.json</code>.</p>

<p>This connection profile now describes the fabric network setup, all the peers, orderers and certificate authorities that are part of the network, it defines all the organizations that are participating in the network and also defines the channel&#39;s on this network. Hyperledger Composer can only interact with a single channel so only one channel should be defined.</p>

<h2 class='alice'>Step Three: Customizing the connection profile for Org1</h2>

<p>This is just a case of specifying the organization that <code>alice</code> belongs to, in a <code>client</code> section with optional timeouts,  add the following block into the above connection profile <code>/tmp/composer/byfn-network.json</code>, between the <code>version</code> property and just before the <code>channel</code> property - once done, save it as a NEW file called  <code>/tmp/composer/org1/byfn-network-org1.json</code>.</p>
<div class="highlight"><pre><code class="language-" data-lang="">    "client": {
        "organization": "Org1",
        "connection": {
            "timeout": {
                "peer": {
                    "endorser": "300",
                    "eventHub": "300",
                    "eventReg": "300"
                },
                "orderer": "300"
            }
        }
    },
</code></pre></div>
<p>So the section of the profile should look like</p>
<div class="highlight"><pre><code class="language-" data-lang="">    ...
    "version": "1.0.0",
    "client": {
        "organization": "Org1",
        "connection": {
            "timeout": {
                "peer": {
                    "endorser": "300",
                    "eventHub": "300",
                    "eventReg": "300"
                },
                "orderer": "300"
            }
        }
    },
    "channel": {
    ...
</code></pre></div>
<h2 class='bob'>Step Four: Building a connection profile for Org2</h2>

<p>Repeat the same process for <code>bob</code> - but this time specify the organization as <code>Org2</code> and then save the file as <code>/tmp/composer/byfn-network-org2.json</code> - so the section of the profile should look like:</p>
<div class="highlight"><pre><code class="language-" data-lang="">    ...
    "version": "1.0.0",
    "client": {
        "organization": "Org2",
        "connection": {
            "timeout": {
                "peer": {
                    "endorser": "300",
                    "eventHub": "300",
                    "eventReg": "300"
                },
                "orderer": "300"
            }
        }
    },
    "channel": {
    ...
</code></pre></div>
<h2 class='alice'>Step Five: Locating the certificate and private key for the Hyperledger Fabric administrator for Org1</h2>

<p>The administrator for our Hyperledger Fabric Org1 network is a user called <code>Admin@org1.example.com</code>. The certificates and private key files for this user are stored in the directory:</p>
<div class="highlight"><pre><code class="language-" data-lang="">crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
</code></pre></div>
<p>You must first locate the certificate file for this user. The certificate is the public part of the identity. The certificate file can be found in the <code>signcerts</code> subdirectory and is named <code>Admin@org1.example.com-cert.pem</code>.</p>

<p>Next, you must locate the private key file for this user. The private key is used to sign transactions as this identity. The private key file can be found in the <code>keystore</code> subdirectory. The name of the private key file is a long hexadecimal string, with a suffix of <code>_sk</code>, for example: <code>78f2139bfcfc0edc7ada0801650ed785a11cfcdef3f9c36f3c8ca2ebfa00a59c_sk</code>. The name will change every time the configuration is generated, hence the wildcard below.</p>

<p>Remember the path to both of these files - or copy them into the same directory as the connection profile file <code>/tmp/composer/org1/byfn-network-org1.json</code> that you created in &#39;Step Three&#39;. You will need these files in the next steps. </p>

<p>Use the following commands to do this:</p>
<div class="highlight"><pre><code class="language-" data-lang="">export ORG1=crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp

cp -p $ORG1/signcerts/A*.pem /tmp/composer/org1

cp -p $ORG1/keystore/*_sk /tmp/composer/org1
</code></pre></div>
<h2 class='bob'>Step Six: Locating the certificate and private key for the Hyperledger Fabric administrator for Org2</h2>

<p>The administrator for our Hyperledger Fabric network is a user called <code>Admin@org2.example.com</code>. The certificates and private key files for this user are stored in the directory:</p>
<div class="highlight"><pre><code class="language-" data-lang="">crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
</code></pre></div>
<p>You must first locate the certificate file for this user. The certificate is the public part of the identity. The certificate file can be found in the <code>signcerts</code> subdirectory and is named <code>Admin@org2.example.com-cert.pem</code>.</p>

<p>Next, you must locate the private key file for this user. The private key is used to sign transactions as this identity. The private key file can be found in the <code>keystore</code> subdirectory. The name of the private key file is a long hexadecimal string, with a suffix of <code>_sk</code>, for example <code>d4889cb2a32e167bf7aeced872a214673ee5976b63a94a6a4e61c135ca2f2dbb_sk</code>. The name will change every time the configuration is generated.</p>

<p>Remember the path to both of these files, or copy them into the same directory as the connection profile file <code>/tmp/composer/byfn-network-org2.json</code> that you created in step four. You will need these files in the next steps.</p>

<p>Use the following commands to do this:</p>
<div class="highlight"><pre><code class="language-" data-lang="">export ORG2=crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp

cp -p $ORG2/signcerts/A*.pem /tmp/composer/org2

cp -p $ORG2/keystore/*_sk /tmp/composer/org2
</code></pre></div>
<h2 class='alice'>Step Seven: Creating business network cards for the Hyperledger Fabric administrator for Org1</h2>

<p>In this step you will create business network cards for the administrator to use to deploy the blockchain business network to the Hyperledger Fabric network.</p>

<p>Run the <code>composer card create</code> command to create a business network card using the connection profile for <code>Org1</code>. You must specify the path to all three files that you either created or located in the previous steps: (note: the <em>sk</em> file will differ.)</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer card create -p /tmp/composer/org1/byfn-network-org1.json -u PeerAdmin -c /tmp/composer/org1/Admin@org1.example.com-cert.pem -k /tmp/composer/org1/*_sk -r PeerAdmin -r ChannelAdmin -f PeerAdmin@byfn-network-org1.card
</code></pre></div>
<p>If the command works successfully, a business network card file called <code>PeerAdmin@byfn-network-org1.card</code> will have been written to the current directory.</p>

<h2 class='bob'>Step Eight: Creating business network cards for the Hyperledger Fabric administrator for Org2</h2>

<p>In this step you will create business network cards for the administrator to use to deploy the blockchain business network to the Hyperledger Fabric network.</p>

<p>Run the <code>composer card create</code> command to create a business network card using the connection profile for <code>Org2</code>. You must specify the path to all three files that you either created or located in the previous steps:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer card create -p /tmp/composer/org2/byfn-network-org2.json -u PeerAdmin -c /tmp/composer/org2/Admin@org2.example.com-cert.pem -k /tmp/composer/org2/*_sk -r PeerAdmin -r ChannelAdmin -f PeerAdmin@byfn-network-org2.card
</code></pre></div>
<p>If the command works successfully, a business network card file called <code>PeerAdmin@byfn-network-org2.card</code> will have been written to the current directory.</p>

<h2 class='alice'>Step Nine: Importing the business network cards for the Hyperledger Fabric administrator for Org1</h2>

<p>Run the <code>composer card import</code> command to import the business network card for <code>Org1</code> into the wallet:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer card import -f PeerAdmin@byfn-network-org1.card --name PeerAdmin@byfn-network-org1
</code></pre></div>
<p>If the command works successfully, a business network card called <code>PeerAdmin@byfn-network-org1</code> will have been imported into the wallet.</p>

<h2 class='bob'>Step Ten: Importing the business network cards for the Hyperledger Fabric administrator for Org2</h2>

<p>Run the <code>composer card import</code> command to import the business network card for <code>Org2</code> into the wallet:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer card import -f PeerAdmin@byfn-network-org2.card --name PeerAdmin@byfn-network-org2
</code></pre></div>
<p>If the command works successfully, a business network card called <code>PeerAdmin@byfn-network-org2</code> will have been imported into the wallet.</p>

<h2 class='alice'>Step Eleven: Installing the Hyperledger Composer runtime onto the Hyperledger Fabric peer nodes for Org1</h2>

<p>Run the <code>composer runtime install</code> command to install the Hyperledger Composer runtime onto all of the Hyperledger Fabric peer nodes for <code>Org1</code> that you specified in the connection profile file you created in &#39;Step Three&#39;:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer runtime install -c PeerAdmin@byfn-network-org1 -n trade-network
</code></pre></div>
<p>As you can see from the above, we are using a Composer business network name called <code>trade-network</code> to test our multi-org environment. You will need a file <code>trade-network.bna</code> (business network archive, from our sample networks) to do the test. If you don&#39;t have this, just go to <a href="https://composer-playground.mybluemix.net/">https://composer-playground.mybluemix.net/</a> and deploy the <code>trade-network</code> sample in the online Playground, then &#39;connect&#39; to the business network as &#39;admin&#39;, and finally export it to the current directory as <code>trade-network.bna</code> . (Note: If you are planning on using a different network, such as the Composer tutorial network <code>tutorial-network</code> as your business network,  you would need to use that name in the <code>runtime install</code> command above and thereafter, as the business network name in this tutorial).</p>

<h2 class='bob'>Step Twelve: Installing the Hyperledger Composer runtime onto the Hyperledger Fabric peer nodes for Org2</h2>

<p>Run the <code>composer runtime install</code> command to install the Hyperledger Composer runtime onto all of the Hyperledger Fabric peer nodes for <code>Org2</code> that you specified in the connection profile file you created in step four:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer runtime install -c PeerAdmin@byfn-network-org2 -n trade-network
</code></pre></div>
<h2 class='everybody'>Step Thirteen: Defining the endorsement policy for the business network</h2>

<p>A running business network has an endorsement policy, which defines the rules around which organizations must endorse transactions before they can be committed to the blockchain. By default, a business network is deployed with an endorsement policy that states that only one organization has to endorse a transaction before it can be committed to the blockchain.</p>

<p>In real world blockchain business networks, multiple organizations will want to ensure that they endorse transactions before they can be committed to the blockchain, and so the default endorsement policy is not suitable. Instead, you can specify a custom endorsement policy when you start a business network.</p>

<p>You can find more information on endorsement policies in the Hyperledger Fabric documentation, in <a href="https://hyperledger-fabric.readthedocs.io/en/release/endorsement-policies.html">Endorsement policies</a>.</p>

<blockquote>
<p>Please note that the endorsement policies used for a business network must be in the JSON format used by the Hyperledger Fabric Node.js SDK. This is a different format to the simple endorsement policy format used by the Hyperledger Fabric CLI, which you will see in the Hyperledger Fabric documentation.</p>
</blockquote>

<p>Create an endorsement policy file called <code>/tmp/composer/endorsement-policy.json</code> with the following contents and save it to disk. You will use this file in later steps, so remember where you place it!</p>
<div class="highlight"><pre><code class="language-" data-lang="">{
    "identities": [
        {
            "role": {
                "name": "member",
                "mspId": "Org1MSP"
            }
        },
        {
            "role": {
                "name": "member",
                "mspId": "Org2MSP"
            }
        }
    ],
    "policy": {
        "2-of": [
            {
                "signed-by": 0
            },
            {
                "signed-by": 1
            }
        ]
    }
}
</code></pre></div>
<p>The endorsement policy you have just created states that both <code>Org1</code> and <code>Org2</code> must endorse transactions in the business network before they can be committed to the blockchain. If <code>Org1</code> or <code>Org2</code> do not endorse transactions, or disagree on the result of a transaction, then the transaction will be rejected by the business network.</p>

<h2 class='everybody'>Step Fourteen: Understanding and selecting the business network administrators</h2>

<p>When a business network is started, the business network must be configured with a set of initial participants. These participants will be responsible for bootstrapping the business network and onboarding other participants into the business network. In Hyperledger Composer, we call these initial participants the business network administrators.</p>

<p>In our business network, the organizations <code>Org1</code> and <code>Org2</code> have equal rights. Each organization will provide a business network administrator for the business network, and those business network administrators will onboard the other participants in their organizations. The business network administrator for <code>Org1</code> will be Alice, and the business network administrator for <code>Org2</code> will be Bob.</p>

<p>When the business network is started, the certificates (the public part of the identity) for all of the business network administrators must be passed to the organization performing the commands to start the business network. After the business network has been started, all of the business network administrators can use their identities to interact with the business network.</p>

<p>You can find more information on business network administrators in <a href="../business-network/bnd-deploy.html">Deploying Business Networks</a>.</p>

<h2 class='alice'>Step Fifteen: Retrieving business network administrator certificates for Org1</h2>

<p>Run the <code>composer identity request</code> command to retrieve certificates for Alice to use as the business network administrator for <code>Org1</code>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer identity request -c PeerAdmin@byfn-network-org1 -u admin -s adminpw -d alice
</code></pre></div>
<p>The <code>-u admin</code> and the <code>-s adminpw</code> options to this command correspond to the default user registered with the Hyperledger Fabric CA (Certificate Authority).</p>

<p>The certficates will be placed into a directory called <code>alice</code> in the current working directory. There are three certificate files created, but only two are important. These are <code>admin-pub.pem</code>, the certificate (including the public key), and <code>admin-priv.pem</code>, the private key. Only the <code>admin-pub.pem</code> file is suitable for sharing with other organizations. The <code>admin-priv.pem</code> file must be kept secret as it can be used to sign transactions on behalf of the issuing organization.</p>

<h2 class='bob'>Step Sixteen: Retrieving business network administrator certificates for Org2</h2>

<p>Run the <code>composer identity request</code> command to retrieve certificates for Bob to use as the business network administrator for <code>Org2</code>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer identity request -c PeerAdmin@byfn-network-org2 -u admin -s adminpw -d bob
</code></pre></div>
<p>The <code>-u admin</code> and the <code>-s adminpw</code> options to this command correspond to the default user registered with the Hyperledger Fabric CA (Certificate Authority).</p>

<p>The certficates will be placed into a directory called <code>bob</code> in the current working directory. There are three certificate files created, but only two are important. These are <code>admin-pub.pem</code>, the certificate (including the public key), and <code>admin-priv.pem</code>, the private key. Only the <code>admin-pub.pem</code> file is suitable for sharing with other organizations. The <code>admin-priv.pem</code> file must be kept secret as it can be used to sign transactions on behalf of the issuing organization.</p>

<h2 class='alice'>Step Seventeen: Starting the business network</h2>

<p>Run the <code>composer network start</code> command to start the business network. Only <code>Org1</code> needs to perform this operation. This command uses the <code>/tmp/composer/endorsement-policy.json</code> file created in step thirteen, and the <code>admin-pub.pem</code> files created by both Alice and Bob in step fifteen and step sixteen, so you must ensure that all of these files are accessible to this command:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer network start -c PeerAdmin@byfn-network-org1 -a trade-network.bna -o endorsementPolicyFile=/tmp/composer/endorsement-policy.json -A alice -C alice/admin-pub.pem -A bob -C bob/admin-pub.pem
</code></pre></div>
<p>Once this command completes, the business network will have been started. Both Alice and Bob will be able to access the business network, start to set up the business network, and onboard other participants from their respective organizations. However, both Alice and Bob must create new business network cards with the certificates that they created in the previous steps so that they can access the business network.</p>

<h2 class='alice'>Step Eighteen: Creating a business network card to access the business network as Org1</h2>

<p>Run the <code>composer card create</code> command to create a business network card that Alice, the business network administrator for <code>Org1</code>, can use to access the business network:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer card create -p /tmp/composer/org1/byfn-network-org1.json -u alice -n trade-network -c alice/admin-pub.pem -k alice/admin-priv.pem
</code></pre></div>
<p>Run the <code>composer card import</code> command to import the business network card that you just created:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer card import -f alice@trade-network.card
</code></pre></div>
<p>Run the <code>composer network ping</code> command to test the connection to the blockchain business network:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer network ping -c alice@trade-network
</code></pre></div>
<p>If the command completes successfully, then you should see the fully qualified participant identifier <code>org.hyperledger.composer.system.NetworkAdmin#alice</code> in the output from the command. You can now use this business network card to interact with the blockchain business network and onboard other participants in your organization.</p>

<p>Lets create a participant, issue an identity (mapped to that participant) and create an asset on the blockchain network as that identity.</p>

<p>Run the <code>composer participant add</code> command below, copying it to the command line to execute:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer participant add -c alice@trade-network -d '{"$class":"org.acme.trading.Trader","tradeId":"trader1-org1", "firstName":"Jo","lastName":"Doe"}'
</code></pre></div>
<p>Next create the identity for <code>trader1-org1</code> with the <code>composer issue identity</code> command below:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer identity issue -c alice@trade-network -f jo.card -u jdoe -a "resource:org.acme.trading.Trader#trader1-org1"
</code></pre></div>
<p>Import the card and test it</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer card import -f jo.card 

composer network ping -c jdoe@trade-network
</code></pre></div>
<p>Next we will create an asset - From the command line, submit a transaction to create a Commodity asset, as participant <code>jdoe</code> (or alternatively, if you already have Composer Playground installed, connect as <code>jdoe@trade-network</code> to <code>trade-network</code> to create the asset &#39;EMA&#39; - the JSON snippet is shown below ).</p>

<p>To create the asset using the CLI - copy the <code>transaction submit</code> sequence below - it creates a Commodity asset for you:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer transaction submit --card jdoe@trade-network -d '{"$class": "org.hyperledger.composer.system.AddAsset","registryType": "Asset","registryId": "org.acme.trading.Commodity", "targetRegistry" : "resource:org.hyperledger.composer.system.AssetRegistry#org.acme.trading.Commodity", "resources": [{"$class": "org.acme.trading.Commodity","tradingSymbol":"EMA", "description":"Corn commodity","mainExchange":"EURONEXT", "quantity":"10","owner":"resource:org.acme.trading.Trader#trader1-org1"}]}'
</code></pre></div>
<p>Or alternatively, to create in Playground - copy the following:</p>
<div class="highlight"><pre><code class="language-" data-lang="">{
  "$class": "org.acme.trading.Commodity",
  "tradingSymbol": "EMA",
  "description": "Corn commodity",
  "mainExchange": "EURONEXT",
  "quantity": 10,
  "owner": "resource:org.acme.trading.Trader#trader1-org1"
}
</code></pre></div>
<p>Finally, do a <code>composer network list</code> to confirm the generated artifacts in the business network:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer network list -c jdoe@trade-network
</code></pre></div>
<h2 class='bob'>Step Nineteen: Creating a business network card to access the business network as Org2</h2>

<p>Run the <code>composer card create</code> command to create a business network card that Bob, the business network administrator for <code>Org2</code>, can use to access the business network:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer card create -p /tmp/composer/org2/byfn-network-org2.json -u bob -n trade-network -c bob/admin-pub.pem -k bob/admin-priv.pem
</code></pre></div>
<p>Run the <code>composer card import</code> command to import the business network card that you just created:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer card import -f bob@trade-network.card
</code></pre></div>
<p>Run the <code>composer network ping</code> command to test the connection to the blockchain business network:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer network ping -c bob@trade-network
</code></pre></div>
<p>If the command completes successfully, then you should see the fully qualified participant identifier <code>org.hyperledger.composer.system.NetworkAdmin#bob</code> in the output from the command. Let&#39;s onboard another Trader, this time for Org 2:</p>

<p>Once again, create a participant, issue an identity (mapped to that participant) - as we already have an asset on the blockchain network, we will use a transaction to change the ownership (from Org1 trader to an Org2 trader):</p>

<p>Run the <code>composer participant add</code> command below, copying it to the command line to execute:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer participant add -c bob@trade-network -d '{"$class":"org.acme.trading.Trader","tradeId":"trader2-org2", "firstName":"Dave","lastName":"Lowe"}'
</code></pre></div>
<p>Next create the identity for <code>trader2-org2</code> with the <code>composer issue identity</code> command below:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer identity issue -c bob@trade-network -f dave.card -u dlowe -a "resource:org.acme.trading.Trader#trader2-org2"
</code></pre></div>
<p>Import the card and test it</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer card import -f dave.card 

composer network ping -c dlowe@trade-network
</code></pre></div>
<p>Lastly, submit a transaction to change ownership of the Commodity asset created earlier. We will submit the transaction as the asset owner Jon Doe and transfer it to trader &#39;Dave Lowe&#39;. We will then verify the ownership change has occurred as the Org 2 trader participant mapped to the <code>dlowe</code> identity: Perform the step below.</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer transaction submit --card jdoe@trade-network -d '{"$class":"org.acme.trading.Trade","commodity":"resource:org.acme.trading.Commodity#EMA","newOwner":"resource:org.acme.trading.Trader#trader2-org2"}'
</code></pre></div>
<p>Finally, do a <code>composer network list</code> as the Org 2 trader participant to confirm the change of ownership on the asset:</p>
<div class="highlight"><pre><code class="language-" data-lang="">composer network list -c dlowe@trade-network
</code></pre></div>
<h2 class='everybody'>Conclusion</h2>

<p>In this tutorial you have seen how to configure a blockchain network based on Hyperledger Composer in a multi-organizational setup.  You&#39;ve also learned how to deploy a business network (such as our Commodities trading network) to that blockchain network and perform some simple transactions as participants in each organization, using identities that were issued by the Certificate of Authorities in either organization.</p>

            
          </section>
        </div>
        <!-- Otherwise, have the main content fill all 12 columns... -->
        
      <div class="PageNavigation">
    
    
  </div>
    </article>
</div>
<script>
(function (document) {
    function clipboard_init() {
        var charts = document.querySelectorAll("div.highlight"),
            arr = [],
            i, j, maxItem, pre, btn, el;

        // Make sure we are dealing with an array
        for(i = 0, maxItem = charts.length; i < maxItem; i++) arr.push(charts[i]);

        // Find the UML source element and get the text
        for (i = 0, maxItem = arr.length; i < maxItem; i++) {
            el = arr[i];
            pre = el.childNodes[0];

            pre.id = "hl_code" + i.toString();
            btn = document.createElement('copy-button');
            btn.appendChild(document.createTextNode('Copy'));
            btn.setAttribute("class", "copy-btn");
            btn.setAttribute("data-clipboard-target", "#hl_code" + i.toString());
            el.insertBefore(btn, pre);
        }
        new Clipboard('.copy-btn');
    };

    function onReady(fn) {
        if (document.addEventListener) {
            document.addEventListener('DOMContentLoaded', fn);
        } else {
            document.attachEvent('onreadystatechange', function() {
                if (document.readyState === 'interactive')
                    fn();
            });
        }
    }

    onReady(function(){
        clipboard_init();
    });
})(document);
</script>
<script src="/composer/next-unstable/assets/js/nav.js"></script>
<script src="/composer/next-unstable/assets/js/search_bar.js"></script>

    

    


  </div>
</body>
</html>
