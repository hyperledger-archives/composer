<h1 id="fabric-composer-modeling-language">Fabric Composer Modeling Language</h1>

<p>Fabric Composer includes an Object-Oriented modeling language that is used to define
the domain model for a business network definition.</p>

<p>A Fabric Composer CTO file is composed of the following elements:</p>

<ol>
  <li>A single namespace. All resource declarations within the file are implicitly
in this namespace.</li>
  <li>Optional import declarations that import resources from other namespaces.</li>
  <li>A set of resource definitions (see below).</li>
</ol>

<h3 id="declarations-of-enumerated-types">Declarations of enumerated types</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>    ```
    /**
     * An enumerated type
     */
    enum AnimalType {
      o SHEEP_GOAT
      o CATTLE
      o PIG
      o DEER_OTHER
    }
    ```
</code></pre>
</div>

<h3 id="declarations-of-assets-participants-transactions">Declarations of Assets, Participants, Transactions</h3>

<p>Assets, Participants and Transactions are class definitions. The
concepts of Asset, Participant and Transaction may be considered to be different
stereotypes of the class type.</p>

<p>A class in Fabric Composer is referred to as a Resource Definition. Therefore an
Asset (instance) has-an Asset Definition.</p>

<p>A resource definition has the following properties:</p>

<ol>
  <li>A name</li>
  <li>A namespace defined by the namespace of its parent file</li>
  <li>An identifying field. For example, the Vehicle asset might be identified by
the vin field. Identifying fields must be Strings.</li>
  <li>An optional super-type, which the resource definition extends.</li>
  <li>An optional ‘abstract’ declaration, to indicate that this type cannot be created</li>
  <li>A set of named fields (data owned by the resource, using a has-a relationship)</li>
  <li>
    <p>A set of relationships to other concerto types that are not owned by the resource
but that may be referenced from the resource. Relationships are unidirectional.</p>

    <p><code class="highlighter-rouge">
 /**
  * A Field asset. A Field is related to a list of animals
  */
 asset Field identified by fieldId {
   o String fieldId
   o String name
   --&gt; Animal[] animals
 }
</code></p>

    <p><code class="highlighter-rouge">
 /**
  * A Farmer participant
  */
 participant Farmer identified by farmerId {
     o String farmerId
     o String firstName
     o String lastName
     o String address1
     o String address2
     o String county
     o String postcode
 }
</code></p>

    <p><code class="highlighter-rouge">
 /**
  * An abstract transaction type for animal movements
  */
 abstract transaction AnimalMovement identified by transactionId {
   o String transactionId
     --&gt; Animal animal
 }
</code></p>

    <p><code class="highlighter-rouge">
 /**
  * A transaction type for an animal leaving a farm
  */
 transaction AnimalMovementDeparture extends AnimalMovement {
   --&gt; Field departureField
 }
</code></p>
  </li>
</ol>

<h3 id="concepts">Concepts</h3>

<p>Concepts are complex types (classes) that are not assets, participants or transactions. They are typically contained by an asset, participant or transaction.</p>

<p>For example, below an abstract concept <code class="highlighter-rouge">Address</code> is defined, and then specialized into a <code class="highlighter-rouge">UnitedStatesAddress</code>. Note that concepts do not have an <code class="highlighter-rouge">identified by</code> field as they cannot be directly stored in registries or referenced in relationships.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>abstract concept Address {
  o String street
  o String city default ="Winchester"
  o String country default = "UK"
  o Integer[] counts optional
}

concept UnitedStatesAddress extends Address {
  o String zipcode
}
</code></pre>
</div>

<h3 id="primitive-types">Primitive types</h3>

<p>Concerto resources are defined in terms of the following primitive types:</p>

<ol>
  <li>String : a UTF8 encoded String</li>
  <li>Double : a double precision 64 bit numeric value</li>
  <li>Integer : a 32 bit signed whole number</li>
  <li>Long : a 64 bit signed whole number</li>
  <li>DateTime : an ISO-8601 compatible time instance, with optional time zone
and UTZ offset</li>
  <li>Boolean : a Boolean value, either true or false.</li>
</ol>

<h3 id="arrays">Arrays</h3>

<p>All types in Concerto may be declared as arrays using the [] notation. Hence</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Integer[] integerArray
</code></pre>
</div>

<p>Is an array of Integers stored in a field called ‘integerArray’. While</p>

<div class="highlighter-rouge"><pre class="highlight"><code>--&gt; Animal[] incoming
</code></pre>
</div>

<p>Is an array of relationships to the Animal type, stored in a field called
‘incoming’.</p>

<h3 id="relationships">Relationships</h3>

<p>A relationship in the Concerto language is a tuple composed of:</p>

<ol>
  <li>The namespace of the type being referenced</li>
  <li>The type name of the type being referenced</li>
  <li>The identifier of the instance being referenced</li>
</ol>

<p>Hence a relationship could be to:
    org.acme.Vehicle#123456</p>

<p>This would be a relationship to the Vehicle type declared in the org.acme
namespace with the identifier 123456.</p>

<p>Relationships are unidirectional and deletes do not cascade, ie. removing the relationship has no impact on the thing that is being pointed to. Removing the thing being pointed to does not invalidate the relationship.</p>

<p>Relationships must be <em>resolved</em> to retrieve an instance of the object being
referenced. The act of resolution may result in null, if the object no longer
exists or the information in the relationship is invalid.</p>

<h3 id="field-validators">Field Validators</h3>

<p>String fields may include an optional regular expression, which is used to validate the contents of the field. Careful use of field validators allows Concerto to perform rich data validation, leading to fewer errors and less boilerplate code.</p>

<p>The example below declares that the <code class="highlighter-rouge">Farmer</code> participant contains a field <code class="highlighter-rouge">postcode</code> that must conform to the regular expression for valid UK postcodes.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>participant Farmer extends Participant {
    o String firstName default="Old"
    o String lastName default="McDonald"
    o String address1
    o String address2
    o String county
    o String postcode regex=/(GIR 0AA)|((([A-Z-[QVf]][0-9][0-9]?)|(([A-Z-[QVf]][A-Z-[IJZ]][0-9][0-9]?)|(([A-Z-[QVf]][0-9][A-HJKPSTUW])|([A-Z-[QVf]][A-Z-[IJZ]][0-9][ABEHMNPRVWfY])))) [0-9][A-Z-[CIKMOV]]{2})/
}
</code></pre>
</div>

<p>Double, Long or Integer fields may include an optional range expression, which is used to validate the contents of the field.</p>

<p>The example below declared that the <code class="highlighter-rouge">Vehicle</code> asset has an Integer field <code class="highlighter-rouge">year</code> which defaults to 2016 and must be 1990, or higher. Range expressions may omit the lower or upper bound if checking is not required.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>asset Vehicle extends Base {
  // An asset contains Fields, each of which can have an optional default value
  o String model default="F150"
  o String make default="FORD"
  o String reg default="ABC123"
  // A numeric field can have a range validation expression
  o Integer year default=2016 range=[1990,] optional // model year must be 1990 or higher
  o Integer[] integerArray
  o State state
  o Double value
  o String colour
  o String V5cID regex=/^[A-z][A-z][0-9]{7}/
  o String LeaseContractID
  o Boolean scrapped default=false
  o DateTime lastUpdate optional
  --&gt; Participant owner //relationship to a Participant, with the field named 'owner'.
  --&gt; Participant[] previousOwners optional // Nary relationship
  o Customer customer
}
</code></pre>
</div>
