<h1 id="coding-and-deploying-a-business-network-definition">Coding and deploying a business network definition</h1>

<hr />

<p>This tutorial will take you through how to code and deploy a Business Network Definition. How to put together the files, code required artifacts, and what to do with them.</p>

<p>The final form of the Business Network Archive (<code class="highlighter-rouge">.bna</code>) is mandatory for . However, the creation and management of the input files is not mandatory.</p>

<p>For this tutorial, a single NPM module will be created for both the model and transaction functions. An archive will be created locally  and deployed. The NPM module consists of your business network definition, and the <code class="highlighter-rouge">package.json</code> file.</p>

<h2 id="before-you-begin">Before you begin</h2>

<p>Typically, a business network would be deployed after fully modelling and testing a business network definition. For this tutorial we are going to continue to use the Digital Property Network sample business network, using only the model file and the transction function file.</p>

<p>You will need the  command line tools. To install the tools run the following command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>npm install -g composer-cli
</code></pre>
</div>

<p><em>Please note: When using Ubuntu this command will fail when running in a root user shell.</em></p>

<p>You will also require a running . For more information on setting up an instance of , see the <a href="">Fabric documentation</a><em>fill this in</em></p>

<h1 id="creating-the-npm-module">Creating the npm module.</h1>

<h2 id="creating-the-basic-infrastrure">Creating the basic infrastrure</h2>

<ol>
  <li>
    <p>Ensure that you have a new clean working directory by using the following command:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> ```bash
 $ mkdir property-network &amp;&amp; cd property-network &amp;&amp; pwd
 /home/matthew/property-network
 ```
</code></pre>
    </div>
  </li>
  <li>
    <p>Now we need to setup the NPM module. The default values can be accepted, but you are welcome to change any that you wish.</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> ```bash
 $ npm init
 This utility will walk you through creating a package.json file.
 It only covers the most common items, and tries to guess sensible defaults.

 See `npm help json` for definitive documentation on these fields
 and exactly what they do.

 Use `npm install &lt;pkg&gt; --save` afterwards to install a package and save it as a dependency in the package.json file.

 Press ^C at any time to quit.
 name: (property-network)
 version: (1.0.0)
 description:
 entry point: (index.js)
 test command:
 git repository:
 keywords:
 author:
 license: (ISC)
 About to write to /home/matthew/property-network/package.json:

 {
   "name": "property-network",
   "version": "1.0.0",
   "description": "",
   "main": "index.js",
   "scripts": {
     "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
   },
   "author": "",
   "license": "ISC"
 }


 Is this ok? (yes) yes
 ```
</code></pre>
    </div>
  </li>
</ol>

<p>The infrastructure is now in place, the model and transaction functions can now be added.</p>

<h2 id="creating-your-model-file">Creating your model file</h2>

<p>The model file defines the assets, participants, and transactions in your business network. It is a simple text file that follows a defined syntax.</p>

<ol>
  <li>
    <p>Create the model (<code class="highlighter-rouge">.cto</code>) file:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> ```bash
 $ touch models/DigitalLandTitle.cto
 ```
</code></pre>
    </div>
  </li>
  <li>
    <p>Open the model file in an editor of your choice and add your own model, or copy in the code below. The following code is the DigitalLandTitle getting started example.</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> ```
 /**  A 'Getting Started Tutorial' to work with Hyperledger Composer
 */

 namespace net.biz.digitalPropertyNetwork

 asset LandTitle identified by titleId {
   o String   titleId
   --&gt; Person   owner
   o String   information
   o Boolean  forSale   optional
 }

 asset SalesAgreement identified by salesId {
   o String    salesId
   --&gt; Person    buyer
   --&gt; Person    seller
   --&gt; LandTitle title
 }

 participant Person identified by personId {
   o String personId
   o String firstName
   o String lastName
 }

 transaction RegisterPropertyForSale identified by transactionId{
   o String transactionId
   --&gt; Person seller
   --&gt; LandTitle title
 }
 ```
</code></pre>
    </div>
  </li>
</ol>

<h2 id="creating-transaction-processor-functions">Creating transaction processor functions</h2>

<p>The transaction processor function file is a standard JavaScript file that defines the operation of your transactions.</p>

<ol>
  <li>
    <p>Create a blank JavaScript file.</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> ```bash
 $ touch lib/DigitalLandTitle.js
 ```
</code></pre>
    </div>
  </li>
  <li>
    <p>Open the transaction processor file in an editor of your choice. Enter either the JavaScript for your own transactions, or use the following JavaScript sample. This sample is the  <code class="highlighter-rouge">registeryPropertyForSale</code> transaction.</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> ```javascript
 'use strict';

 /**
  * Process a property that is held for sale
  * @param {net.biz.digitalPropertyNetwork.RegisterPropertyForSale} propertyForSale the property to be sold
  * @transaction
  */
 function onRegisterPropertyForSale(propertyForSale) {
     console.log('### onRegisterPropertyForSale ' + propertyForSale.toString());
     propertyForSale.title.forSale = true;

     returAssetRegistry('net.biz.digitalPropertyNetwork.LandTitle').then(function(result) {
             return result.update(propertyForSale.title);
         }
     );
 }
 ```
</code></pre>
    </div>
  </li>
</ol>

<p>Now that the <code class="highlighter-rouge">package.json</code> file has been created in addition to the business network definition, the npm module for the business network has been created. The next step is to form this into a business network archive (<code class="highlighter-rouge">.bna</code>) file to be depoloyed to an instance of .</p>

<hr />

<h1 id="creating-the-business-network-archive-and-deploying-to">Creating the business network archive and deploying to</h1>

<p>Now that the business network has been defined, a business network archive must be created. This requires all the files in the business network definition created above. The business network archive (<code class="highlighter-rouge">.bna</code>) file can then be deployed to .</p>

<p>There is a <code class="highlighter-rouge">composer archive</code> command that can be used to create and inspect these archives. The <code class="highlighter-rouge">composer network</code> command is then used to administer the business network archive on the Hyperledger Fabric.</p>

<ol>
  <li>Use the <code class="highlighter-rouge">composer archive create</code> command to create the archive. The <code class="highlighter-rouge">--archiveFile</code> option is used to specify the name of the archive file to create. If no filename is specified, a default name will be created  based on the identifier of the business network (sanitized to be suitable as a filename). For example <code class="highlighter-rouge">digitalPropertyNetwork-0.1.2.bna</code>.</li>
</ol>

<p>There are two options that control where the inputs for the archive create from.</p>

<ul>
  <li><code class="highlighter-rouge">--sourceType</code> can either be <code class="highlighter-rouge">dir</code> or <code class="highlighter-rouge">module</code>. Specifying <code class="highlighter-rouge">dir</code> implies that the source is from a directory. Specifying <code class="highlighter-rouge">module</code> indicates that the source is an installed NPM module.</li>
  <li><code class="highlighter-rouge">--sourceName</code> is either the directory name or the NPM module name as appropriate.</li>
</ul>

<p>In the case of a directory being given, this directory must contain the appropriate <code class="highlighter-rouge">package.json</code> file.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    ```bash
    $ composer archive create --archiveFile digitalLandTitle.bna --sourceType dir --sourceName .
    ```
</code></pre>
</div>

<ol>
  <li>
    <p>To deploy an archive file Once you have this archive it can then be deployed to Hyperledger (which will assuming is all running for the moment)</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> ```bash
 $ composer network deploy --archiveFile  DigitalLandTitle.bna  --enrollId WebAppAdmin --enrollSecret DJY27pEnl16d
 ```
</code></pre>
    </div>
  </li>
</ol>

<h1 id="next-steps-to-develop-the-model-or-transaction-processor-functions">Next steps to develop the model or transaction processor functions</h1>

<p>The next step in the development process would be to update either the model or transaction functions or both. When youâ€™ve done this, the steps are to recreate the archive and then redeploy the network.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>composer archive create --archiveFile digitalLandTitle.bna ---sourceType dir --sourceName .
<span class="gp">$ </span>composer network update --archiveFile digitalproperty-network@0.0.1.bna  --enrollId WebAppAdmin --enrollSecret DJY27pEnl16d
</code></pre>
</div>

<h1 id="complete">Complete!</h1>

<p>This tutorial is now complete. The next step would be to create a REST API for applications to use. The <a href="../applications/genapp.html">next step</a> will create a REST api for the Digital Property Network.</p>
