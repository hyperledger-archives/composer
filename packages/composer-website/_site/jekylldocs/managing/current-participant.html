<h1 id="implementing-access-control-using-the-current-participant">Implementing access control using the current Participant</h1>

<hr />

<p>The current participant can be used to implement access control in a transaction
processor function. You can use the type and the identifier of the current
participant to permit or reject the execution of a transaction processor function.</p>

<h2 id="before-you-start">Before you start</h2>

<p>Before you follow these steps, you must have modelled a participant in a Business
Network Definition and deployed it as a Business Network. You must have created
some instances of those participants, and issued those participants with identities.</p>

<p>The procedure below shows an example using the following participant models:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>namespace net.biz.digitalPropertyNetwork

participant Person identified by personId {
  o String personId
  o String firstName
  o String lastName
}

participant PrivilegedPerson extends Person {

}
</code></pre>
</div>

<h2 id="procedure">Procedure</h2>

<ol>
  <li>
    <p>In your transaction processor function, verify the type of the current participant
meets the requirements by using the <code class="highlighter-rouge">getCurrentParticipant</code> function:</p>

    <div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">onPrivilegedTransaction</span><span class="p">(</span><span class="nx">privilegedTransaction</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">currentParticipant</span> <span class="o">=</span> <span class="nx">getCurrentParticipant</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">currentParticipant</span><span class="p">.</span><span class="nx">getFullyQualifiedType</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">'net.biz.digitalPropertyNetwork.PrivilegedPerson'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Transaction can only be submitted by a privileged person'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Current participant must be a privileged person to get here.</span>
<span class="p">}</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>In your transaction processor function, verify the participant ID of the current
participant by using the <code class="highlighter-rouge">getCurrentParticipant</code> function:</p>

    <div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">onPrivilegedTransaction</span><span class="p">(</span><span class="nx">privilegedTransaction</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">currentParticipant</span> <span class="o">=</span> <span class="nx">getCurrentParticipant</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">currentParticipant</span><span class="p">.</span><span class="nx">getFullyQualifiedIdentifier</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">'net.biz.digitalPropertyNetwork.Person#PERSON_1'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Transaction can only be submitted by person 1'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Current participant must be person 1 to get here.</span>
<span class="p">}</span>
</code></pre>
    </div>

    <p>The participant ID of the current participant can be compared to a participant
that is linked to an asset (by a relationship) to verify that the current
participant has the authority to access or modify an asset:</p>

    <div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">onPrivilegedTransaction</span><span class="p">(</span><span class="nx">privilegedTransaction</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Get the owner of the asset in the transaction.</span>
    <span class="kd">var</span> <span class="nx">assetOwner</span> <span class="o">=</span> <span class="nx">privilegedTransaction</span><span class="p">.</span><span class="nx">asset</span><span class="p">.</span><span class="nx">owner</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">currentParticipant</span> <span class="o">=</span> <span class="nx">getCurrentParticipant</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">currentParticipant</span><span class="p">.</span><span class="nx">getFullyQualifiedIdentifier</span><span class="p">()</span> <span class="o">!==</span> <span class="nx">asset</span><span class="p">.</span><span class="nx">owner</span><span class="p">.</span><span class="nx">getFullyQualifiedIdentifier</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Transaction can only be submitted by the owner of the asset'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Current participant must be the owner of the asset to get here.</span>
<span class="p">}</span>
</code></pre>
    </div>
  </li>
</ol>
