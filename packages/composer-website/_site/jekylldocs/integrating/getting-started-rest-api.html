<h1 id="generating-a-rest-api">Generating a REST API</h1>

<hr />

<p>This guide will show how to generate a REST API for the Digital Property sample business network. This api will be dynamically generated by using <a href="https://loopback.io/doc/index.html">LoopBack</a> from the specified Business Network Model. What is generated is not a generic API, but is specifically configured to let you interact with the assets you have specified.</p>

<p>To get started with using this to create a REST interface to a Business Network, follow the steps below.  If you’ve not followed the <a href="../installing/quickstart.md">Getting Started</a> guide yet, it’s worth following that first so you have  up and running on Hyperledger.</p>

<h1 id="check-that-the-digital-land-title-network-is-up-and-running">Check that the Digital Land Title Network is up and running</h1>

<p>Let’s check the assets that are in the Digital Land Title registries. From your existing getting started directory issue</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>npm run listAssets

<span class="gp">&gt; </span>getting-started@1.0.0 listAssets /home/matthew/github_lenny/sample-applications/packages/getting-started
<span class="gp">&gt; </span>node cli.js landregistry list

info: <span class="o">[</span>Composer-GettingStarted] Hyperledger Composer: Getting Started appliation
info: <span class="o">[</span>Composer-GettingStarted] LandRegistry:&lt;init&gt; businessNetworkDefinition obtained digitalproperty-network@0.0.22
info: <span class="o">[</span>Composer-GettingStarted] listTitles Getting the asset registry
info: <span class="o">[</span>Composer-GettingStarted] listTitles Getting all assest from the registry.
info: <span class="o">[</span>Composer-GettingStarted] listTitles Current Land Titles
info: <span class="o">[</span>Composer-GettingStarted] Titles listed
info: <span class="o">[</span>Composer-GettingStarted]
┌──────────┬────────────────┬────────────┬─────────┬──────────────────────────────────────────────────────────┬─────────┐
│ TitleID  │ OwnerID        │ First Name │ Surname │ Description                                              │ ForSale │
├──────────┼────────────────┼────────────┼─────────┼──────────────────────────────────────────────────────────┼─────────┤
│ LID:1148 │ PID:1234567890 │ Fred       │ Bloggs  │ A nice house <span class="k">in </span>the country Updated at: Thu, 02 Mar 2017 │ Yes     │
├──────────┼────────────────┼────────────┼─────────┼──────────────────────────────────────────────────────────┼─────────┤
│ LID:6789 │ PID:1234567890 │ Fred       │ Bloggs  │ A small flat <span class="k">in </span>the city                                 │ No      │
└──────────┴────────────────┴────────────┴─────────┴──────────────────────────────────────────────────────────┴─────────┘
info: <span class="o">[</span>Composer-GettingStarted] Command completed successfully.


</code></pre>
</div>

<p>We can see the two sample land titles listed.</p>

<h2 id="install-the-general-purpose-composer-rest-server">Install the general purpose Composer REST Server</h2>

<p>We need to install the  REST server; this is an npm module named <code class="highlighter-rouge">composer-rest-server</code>`.</p>

<blockquote>
  <p>You might need to issue this command using sudo.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install -g composer-rest-server
</code></pre>
</div>

<h2 id="running-the-rest-server">Running the REST server</h2>
<p>You should now be able to run the  REST server.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>composer-rest-server
</code></pre>
</div>

<p>You will then be asked to enter a few simple details about your business network.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>
 _   _                       _          _                 
| | | |_   _ _ __   ___ _ __| | ___  __| | __ _  ___ _ __
| |_| | | | | <span class="s1">'_ \ / _ \ '</span>__| |/ _ <span class="se">\/</span> _<span class="sb">`</span> |/ _<span class="sb">`</span> |/ _ <span class="se">\ </span><span class="s1">'__|
|  _  | |_| | |_) |  __/ |  | |  __/ (_| | (_| |  __/ |   
|_| |_|\__, | .__/ \___|_|  |_|\___|\__,_|\__, |\___|_|   
       |___/|_|                           |___/           
  ____                                          
 / ___|___  _ __ ___  _ __   ___  ___  ___ _ __
| |   / _ \| '</span>_ <span class="sb">`</span> _ <span class="se">\|</span> <span class="s1">'_ \ / _ \/ __|/ _ \ '</span>__|
| |__| <span class="o">(</span>_<span class="o">)</span> | | | | | | |_<span class="o">)</span> | <span class="o">(</span>_<span class="o">)</span> <span class="se">\_</span>_ <span class="se">\ </span> __/ |   
 <span class="se">\_</span>___<span class="se">\_</span>__/|_| |_| |_| .__/ <span class="se">\_</span>__/|___/<span class="se">\_</span>__|_|   
                     |_|                                                     
? Enter your Fabric Connection Profile Name: defaultProfile
? Enter your Business Network Identifier : digitalproperty-network
? Enter your Fabric username : WebAppAdmin
? Enter your secret: DJY27pEnl16d
Loopback Connector <span class="k">for </span>Hyperledger Composer
Models Loaded Now
Browse your REST API at http://0.0.0.0:3000/explorer
</code></pre>
</div>

<h2 id="looking-at-the-generated-apis">Looking at the generated APIs</h2>

<p>Launch your browser and go to the URL given (http://0.0.0.0:3000/explorer).  You’ll see a screen similar to this.</p>

<p><img src="./images/loopback-1.png" alt="LoopBack-1" /></p>

<p>Select the Land Title asset, and you can see all the REST APIs that have generated for this asset. At present get and put are fully implemented, with transactions  - so lets try and get a list of all the land titles.;</p>

<p><img src="./images/loopback-2.png" alt="LoopBack-2" /></p>

<p>Expand the get and click on <em>Try it Out</em> to try it out.</p>

<p><img src="./images/loopback-3.png" alt="LoopBack-3" /></p>

<p>You’ll see a list of land titles presented as a set of JSON</p>

<p><img src="./images/loopback-4.png" alt="LoopBack-4" /></p>

<p>Similarly it’s quite easy to issue the curl command from a terminal prompt. This can be copied from the LoopBack web page. To help format the JSON ouptut so it’s easier to read install the <em>prettyjson</em> package.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>npm install -g prettyjson
</code></pre>
</div>

<p>Then issue the curl command.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>curl -X GET --header <span class="s2">"Accept: application/json"</span> <span class="s2">"http://0.0.0.0:3000/api/net.biz.digitalPropertyNetwork.LandTitle"</span> | prettyjson
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   518  100   518    0     0    549      0 --:--:-- --:--:-- --:--:--   548
-
  titleId:     LID:1148
  owner:
    <span class="nv">$class</span>:    net.biz.digitalPropertyNetwork.Person
    personId:  PID:1234567890
    firstName: Fred
    lastName:  Bloggs
  information: A nice house <span class="k">in </span>the country Updated at: Thu, 02 Mar 2017
  forSale:     <span class="nb">true</span>
  <span class="nv">$class</span>:      net.biz.digitalPropertyNetwork.LandTitle
-
  titleId:     LID:6789
  owner:
    <span class="nv">$class</span>:    net.biz.digitalPropertyNetwork.Person
    personId:  PID:1234567890
    firstName: Fred
    lastName:  Bloggs
  information: A small flat <span class="k">in </span>the city
  forSale:     <span class="nb">true</span>
  <span class="nv">$class</span>:      net.biz.digitalPropertyNetwork.LandTitle
</code></pre>
</div>
<h2 id="submitting-a-transaction-via-rest">Submitting a transaction via REST</h2>

<p>If you go back to the main page and search down to the register property for sale, we can mark the other property for sale.
In this example, we’ve specified the other landtitle in the data box, we’ve also had to specify the transaction id and the timestamp (the last two will change shortly).</p>

<p><img src="./images/loopback-5.png" alt="LoopBack-5" /></p>

<p>Click on the <em>Try it out!</em> button to submit the transaction. You’ll see a succesful return code, but if you now return to your terminal prompt in the Getting Started directory, you can run the list assets command again.</p>

<p>You’ll see now that the other land title has been marked for sale.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>npm run listAssets

<span class="gp">&gt; </span>getting-started@1.0.0 listAssets /home/matthew/github_lenny/sample-applications/packages/getting-started
<span class="gp">&gt; </span>node cli.js landregistry list

info: <span class="o">[</span>Composer-GettingStarted] Hyperledger Composer: Getting Started appliation
info: <span class="o">[</span>Composer-GettingStarted] LandRegistry:&lt;init&gt; businessNetworkDefinition obtained digitalproperty-network@0.0.22
info: <span class="o">[</span>Composer-GettingStarted] listTitles Getting the asset registry
info: <span class="o">[</span>Composer-GettingStarted] listTitles Getting all assest from the registry.
info: <span class="o">[</span>Composer-GettingStarted] listTitles Current Land Titles
info: <span class="o">[</span>Composer-GettingStarted] Titles listed
info: <span class="o">[</span>Composer-GettingStarted]
┌──────────┬────────────────┬────────────┬─────────┬──────────────────────────────────────────────────────────┬─────────┐
│ TitleID  │ OwnerID        │ First Name │ Surname │ Description                                              │ ForSale │
├──────────┼────────────────┼────────────┼─────────┼──────────────────────────────────────────────────────────┼─────────┤
│ LID:1148 │ PID:1234567890 │ Fred       │ Bloggs  │ A nice house <span class="k">in </span>the country Updated at: Thu, 02 Mar 2017 │ Yes     │
├──────────┼────────────────┼────────────┼─────────┼──────────────────────────────────────────────────────────┼─────────┤
│ LID:6789 │ PID:1234567890 │ Fred       │ Bloggs  │ A small flat <span class="k">in </span>the city Updated at: Thu, 02 Mar 2017    │ Yes     │
└──────────┴────────────────┴────────────┴─────────┴──────────────────────────────────────────────────────────┴─────────┘
info: <span class="o">[</span>Composer-GettingStarted] Command completed successfully.
</code></pre>
</div>

<p>#Summary
Using the Loopback framework on top of the  runtime has allowed us to generate a business domain specific REST api based on the deployed business network model!</p>
