<div *ngIf="connectionProfileData">
    <form (ngSubmit)="onSubmit()" #connectionProfileForm="ngForm" (keydown)="onSubmit($event)">
        <section class="profile-section delimited">
            <div class="description upper">Basic Configuration</div>
            <div class="data">
                <table class="profile-info extra-space-right extra-space-left">
                    <colgroup>
                        <col span="1" style="width: 11%;">
                        <col span="1" style="width: 89%;">
                    </colgroup>
                    <tr>
                        <th>
                            Connection Profile Name*
                        </th>
                        <td>
                            <input [ngClass]="{'error-underline': name.invalid && (name.dirty || name.touched)}"
                                   type="text"
                                   [(ngModel)]="basic.name" #name="ngModel" name="name" required>
                            <div *ngIf="name.invalid && (name.dirty || name.touched)" class="error-message">
                                Name is required
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            Profile Description
                        </th>
                        <td>
                            <input type="text" ([ngModel])="basic.description" name="description">
                        </td>
                    </tr>
                    <tr>
                        <th>
                            Organisation*
                        </th>
                        <td>
                            <input
                                [ngClass]="{'error-underline': organisation.invalid && (organisation.dirty || organisation.touched)}"
                                type="text"
                                [(ngModel)]="basic.organisation" #organisation="ngModel" name="organisation" required>
                            <div *ngIf="organisation.invalid && (organisation.dirty || organisation.touched)"
                                 class="error-message">
                                Organisation is required
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            MSPID*
                        </th>
                        <td>
                            <input
                                [ngClass]="{'error-underline': mspid.invalid && (mspid.dirty || mspid.touched)}"
                                type="text"
                                [(ngModel)]="basic.mspid" #mspid="ngModel" name="mspid" required>
                            <div *ngIf="mspid.invalid && (mspid.dirty || mspid.touched)" class="error-message">
                                MSPID is required
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            Channel*
                        </th>
                        <td>
                            <input
                                [ngClass]="{'error-underline': channel.invalid && (channel.dirty || channel.touched)}"
                                type="text"
                                [(ngModel)]="basic.channel" #channel="ngModel" name="channel" required>
                            <div *ngIf="channel.invalid && (channel.dirty || channel.touched)" class="error-message">
                                Channel is required
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            KeyValStore*
                        </th>
                        <td>
                            <input
                                [ngClass]="{'error-underline': keyValStore.invalid && (keyValStore.dirty || keyValStore.touched)}"
                                type="text"
                                [(ngModel)]="basic.keyValStore" #keyValStore="ngModel" name="keyValStore" required>
                            <div *ngIf="keyValStore.invalid && (keyValStore.dirty || keyValStore.touched)" class="error-message">
                                KeyValStore is required
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </section>
        <section class="profile-section delimited">
            <div class="description upper">Orderer(s)</div>
            <div class="data">
                <div *ngFor="let orderer of orderers; let ordererIndex = index" class="property-set">
                    <table class="profile-info">
                        <colgroup>
                            <col span="1" style="width: 10%;">
                            <col span="1" style="width: 55%;">
                            <col span="1" style="width: 34%;">
                        </colgroup>
                        <tr>
                            <th>
                                Name*
                            </th>
                            <td>
                                <input
                                    [ngClass]="{'error-underline': ordererName.invalid && (ordererName.dirty || ordererName.touched)}"
                                    type="text"
                                    [(ngModel)]="orderer.name" #ordererName="ngModel" name="ordererName{{ordererIndex}}" required>
                                <div *ngIf="ordererName.invalid && (ordererName.dirty || ordererName.touched)"
                                     class="error-message">
                                    Orderer name is required
                                </div>
                            </td>
                            <td>
                                <button type="button"
                                        class="certificate-button"
                                        [ngClass]="{'no-cert': !orderer.tlsCACerts.pem}"
                                        (click)="openAddCertificateModal(ordererIndex,'orderers');">
                                    <svg class="standard-icon" aria-hidden="true">
                                        <use xlink:href="#icon-data-quality_16"></use>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Url*
                            </th>
                            <td>
                                <input
                                    [ngClass]="{'error-underline': ordererUrl.invalid && (ordererUrl.dirty || ordererUrl.touched)}"
                                    type="text"
                                    [(ngModel)]="orderer.url" #ordererUrl="ngModel" name="ordererUrl{{ordererIndex}}" required>
                                <div *ngIf="ordererUrl.invalid && (ordererUrl.dirty || ordererUrl.touched)"
                                     class="error-message">
                                    Orderer url is required
                                </div>
                            </td>
                        </tr>
                    </table>
                    <table class="profile-info">
                        <colgroup>
                            <col span="1" style="width: 10%;">
                            <col span="1" style="width: 8%;">
                            <col span="1" style="width: 47.5%;">
                            <col span="1" style="width: 34.5%;">
                        </colgroup>
                        <tr>
                            <th rowspan="2">GRPC Options</th>
                            <th>
                                ssl target name override
                            </th>
                            <td>
                                <input type="text" [(ngModel)]="orderer.grpcOptions.sslTargetNameOverride" name="ordererSslTargetNameOverride{{ordererIndex}}">
                            </td>
                            <td>
                                <div class="profile-buttons">
                                    <button type="button" class="secondary" *ngIf="ordererIndex === orderers.length -1"
                                            (click)="addOrderer()">+ Add another
                                    </button>
                                    <button type="button" class="secondary" *ngIf="orderers.length > 1"
                                            (click)="removeOrderer(ordererIndex)">
                                        Remove orderer
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <table class="profile-info extra-space-right extra-space-left">
                    <colgroup>
                        <col span="1" style="width: 11%;">
                        <col span="1" style="width: 89%;">
                    </colgroup>
                    <tr>
                        <th>Timeout</th>
                        <td>
                            <input type="text" [(ngModel)]="ordererTimeout"
                                   name="ordererTimeout"></td>
                    </tr>
                </table>
            </div>
        </section>
        <section class="profile-section delimited">
            <div class="description upper">Peer(s)</div>
            <div class="data">
                <div *ngFor="let peer of peers; let peerIndex = index" class="property-set">
                    <table class="profile-info">
                        <colgroup>
                            <col span="1" style="width: 10%;">
                            <col span="1" style="width: 55%;">
                            <col span="1" style="width: 34%;">
                        </colgroup>
                        <tr>
                            <th>
                                Name*
                            </th>
                            <td>
                                <input
                                    [ngClass]="{'error-underline': peerName.invalid && (peerName.dirty || peerName.touched)}"
                                    type="text"
                                    [(ngModel)]="peer.name" #peerName="ngModel" name="peerName{{peerIndex}}" required>
                                <div *ngIf="peerName.invalid && (peerName.dirty || peerName.touched)"
                                     class="error-message">
                                    Peer name is required
                                </div>
                            </td>
                            <td>
                                <button type="button"
                                        class="certificate-button"
                                        [ngClass]="{'no-cert': !peer.tlsCACerts.pem}"
                                        (click)="openAddCertificateModal(peerIndex,'peers');">
                                    <svg class="standard-icon" aria-hidden="true">
                                        <use xlink:href="#icon-data-quality_16"></use>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Url*
                            </th>
                            <td>
                                <input
                                    [ngClass]="{'error-underline': peerUrl.invalid && (peerUrl.dirty || peerUrl.touched)}"
                                    type="text"
                                    [(ngModel)]="peer.url" #peerUrl="ngModel" name="peerUrl{{peerIndex}}" required>
                                <div *ngIf="peerUrl.invalid && (peerUrl.dirty || peerUrl.touched)"
                                     class="error-message">
                                    Peer url is required
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Event Url*
                            </th>
                            <td>
                                <input
                                    [ngClass]="{'error-underline': peerEventUrl.invalid && (peerEventUrl.dirty || peerEventUrl.touched)}"
                                    type="text"
                                    [(ngModel)]="peer.eventUrl" #peerEventUrl="ngModel" name="peerEventUrl{{peerIndex}}" required>
                                <div *ngIf="peerEventUrl.invalid && (peerEventUrl.dirty || peerEventUrl.touched)"
                                     class="error-message">
                                    Peer event url is required
                                </div>
                            </td>
                        </tr>
                    </table>
                    <table class="profile-info">
                        <colgroup>
                            <col span="1" style="width: 10%;">
                            <col span="1" style="width: 8%;">
                            <col span="1" style="width: 47.5%;">
                            <col span="1" style="width: 34.5%;">
                        </colgroup>
                        <tr>
                            <th rowspan="2">GRPC Options</th>
                            <th>
                                ssl target name override
                            </th>
                            <td>
                                <input type="text" [(ngModel)]="peer.grpcOptions.sslTargetNameOverride"
                                       name="peerSslTargetNameOverride{{peerIndex}}">
                            </td>
                            <td>
                                <div class="profile-buttons">
                                    <button type="button" class="secondary" *ngIf="peerIndex === peers.length -1"
                                            (click)="addPeer()">+ Add another
                                    </button>
                                    <button type="button" class="secondary" *ngIf="peers.length > 1"
                                            (click)="removePeer(peerIndex)">
                                        Remove peer
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div>
                    <table class="profile-info extra-space-left extra-space-right">
                        <colgroup>
                            <col span="1" style="width: 10%;">
                            <col span="1" style="width: 10%;">
                            <col span="1" style="width: 80%;">
                        </colgroup>
                        <tr>
                            <th rowspan="3">Timeout</th>
                            <th>
                                endorser
                            </th>
                            <td>
                                <input type="text" [(ngModel)]="peerTimeOut.endorser"
                                       name="peerTimeoutEndorser">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                eventHub
                            </th>
                            <td>
                                <input type="text" [(ngModel)]="peerTimeOut.eventHub"
                                       name="peerTimeoutEventHub">
                            </td>
                        </tr>
                        <tr>
                            <th>
                                eventReg
                            </th>
                            <td>
                                <input type="text" [(ngModel)]="peerTimeOut.eventReg"
                                       name="peerTimeoutEventReg">
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </section>
        <section class="profile-section delimited">
            <div class="description upper">Certificate Authority</div>
            <div class="data">
                <table class="profile-info extra-space-left">
                    <colgroup>
                        <col span="1" style="width: 11%;">
                        <col span="1" style="width: 55%;">
                        <col span="1" style="width: 34%;">
                    </colgroup>
                    <tr>
                        <th>
                            Name
                        </th>
                        <td>
                            <input type="text" [(ngModel)]="ca.caName" name="caName">
                        </td>
                        <td>
                            <button type="button"
                                    class="certificate-button"
                                    [ngClass]="{'no-cert': !ca.tlsCACerts.pem}"
                                    (click)="openAddCertificateModal(0,'ca');">
                                <svg class="standard-icon" aria-hidden="true">
                                    <use xlink:href="#icon-data-quality_16"></use>
                                </svg>
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            Url*
                        </th>
                        <td>
                            <input
                                [ngClass]="{'error-underline': caUrl.invalid && (caUrl.dirty || caUrl.touched)}"
                                type="text"
                                [(ngModel)]="ca.url" #caUrl="ngModel" name="caUrl" required>
                            <div *ngIf="caUrl.invalid && (caUrl.dirty || caUrl.touched)" class="error-message">
                                Certificate authority url is required
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </section>
        <footer>
            <div>
                <button class="secondary" (click)="stopEditing()">Cancel</button>
                <button class="primary" type="submit" [disabled]="!connectionProfileForm.form.valid">Next</button>
            </div>
        </footer>
    </form>
</div>
