<div *ngIf="connectionProfileData">

  <div class="profile-header" *ngIf="!editing">
    <div class="profile-header-details">
      <div class="profile-title">
        <h1 *ngIf="connectionProfileData.name !== '$default'">{{connectionProfileData.name}}</h1>
        <h1 *ngIf="connectionProfileData.name === '$default'">Web Browser</h1>
      </div>
      <div class="profile-actions">
        <button type="button" class="action margin-right" (click)="startEditing()">
          <svg *ngIf="connectionProfileData.name !== '$default'" class="standard-icon" aria-hidden="true">
            <use xlink:href="#icon-edit_16"></use>
          </svg>
        </button>
        <button type="button" class="action margin-right" (click)="deleteProfile()">
          <svg *ngIf="connectionProfileData.name !== '$default'" class="standard-icon" aria-hidden="true">
            <use xlink:href="#icon-bin_icon"></use>
          </svg>
        </button>
      </div>
    </div>
    <div>
      <p *ngIf="connectionProfileData.name !== '$default'">{{connectionProfileData.profile.description}}</p>
      <p *ngIf="connectionProfileData.name === '$default'">Running in web browser mode</p>
    </div>
  </div>




  <!-- DISPLAY V0.6 CONNECTION PROFILE -->

  <div class="profile-data-container" *ngIf="connectionProfileData.profile.type === 'hlf' && !editing">
    <div class="profile-data-header">
      <div class="section-details">
        <div class="section-name" (click)="expandSection('Basic Configuration')">
          Basic Configuration
        </div>
        <div class="section-expand">
          <button class="button secondary" type="button" (click)="expandSection('All')">{{expandedSection.length === 3 ? 'Collapse All' : 'Expand All'}}</button>
          <button type="button" class="action" (click)="expandSection('Basic Configuration')">
            <svg [ngClass]="{'chevron': expandedSection.indexOf('Basic Configuration') < 0}" class="standard-icon" *ngIf="showExpand" aria-hidden="true">
              <use xlink:href="#icon-chevron-down"></use>
            </svg>
          </button>
        </div>
      </div>
      <div class="data-section" [ngClass]="{'expanded' : expandedSection.indexOf('Basic Configuration') > -1}">
        <div class="profile-row">
          <div class="profile-property">
            Connection Profile Name
          </div>
          <div class="profile-value">
            {{connectionProfileData.name}}
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Peer URL
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.peerURL}}
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Membership Services URL
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.membershipServicesURL}}
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Event Hub URL
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.eventHubURL}}
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Key Value Store Directory
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.keyValStore}}
          </div>
        </div>
      </div>
    </div>
    <div class="profile-data-header">
      <div class="section-details">
        <div class="section-name" (click)="expandSection('Security Settings')">
          Security Settings
        </div>
        <div class="section-expand">
          <button type="button" class="action" (click)="expandSection('Security Settings')">
            <svg [ngClass]="{'chevron': expandedSection.indexOf('Security Settings') < 0}" class="standard-icon" *ngIf="showExpand" aria-hidden="true">
              <use xlink:href="#icon-chevron-down"></use>
            </svg>
          </button>
        </div>
      </div>
      <div class="data-section" [ngClass]="{'expanded' : expandedSection.indexOf('Security Settings') > -1}">
        <div class="profile-row">
          <div class="profile-property">
            Certificate
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.certificate}}
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Certificate Path
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.certificatePath}}
          </div>
        </div>
      </div>
    </div>
    <div class="profile-data-header">
      <div class="section-details">
        <div class="section-name" (click)="expandSection('Advanced')">
          Advanced
        </div>
        <div class="section-expand">
          <button type="button" class="action" (click)="expandSection('Advanced')">
            <svg [ngClass]="{'chevron': expandedSection.indexOf('Advanced') < 0}" class="standard-icon" *ngIf="showExpand" aria-hidden="true">
              <use xlink:href="#icon-chevron-down"></use>
            </svg>
          </button>
        </div>
      </div>
      <div class="data-section" [ngClass]="{'expanded' : expandedSection.indexOf('Advanced') > -1}">
        <div class="profile-row">
          <div class="profile-property">
            Deploy Wait Time (seconds)
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.deployWaitTime}}
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Invoke Wait Time (seconds)
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.invokeWaitTime}}
          </div>
        </div>
      </div>
    </div>
  </div>



  <!-- DISPLAY V1 CONNECTION PROFILE -->

  <div class="profile-data-container" *ngIf="connectionProfileData.profile.type === 'hlfv1' && !editing">
    <div class="profile-data-header">
      <div class="section-details">
        <div class="section-name" (click)="expandSection('Basic Configuration')">
          Basic Configuration
        </div>
        <div class="section-expand">
          <button class="button secondary" type="button" (click)="expandSection('All')">{{expandedSection.length === 2 ? 'Collapse All' : 'Expand All'}}</button>
          <button type="button" class="action" (click)="expandSection('Basic Configuration')">
            <svg [ngClass]="{'chevron': expandedSection.indexOf('Basic Configuration') < 0}" class="standard-icon" *ngIf="showExpand" aria-hidden="true">
              <use xlink:href="#icon-chevron-down"></use>
            </svg>
          </button>
        </div>
      </div>
      <div class="data-section" [ngClass]="{'expanded' : expandedSection.indexOf('Basic Configuration') > -1}">
        <div class="profile-row">
          <div class="profile-property">
            Connection Profile Name
          </div>
          <div class="profile-value">
            {{connectionProfileData.name}}
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Orderer(s)
          </div>
          <div class="profile-value">
            <div class="nested-section" *ngFor="let orderer of connectionProfileData.profile.orderers">
              <div class="nested-row">
                <div class="nested-property">Orderer URL</div>
                <div class="nested-value">{{orderer.url}}</div>
                <button type="button" class="certificate-button" (click)="showCertificate(orderer.cert,orderer.hostnameOverride)">
                <svg class="standard-icon" aria-hidden="true">
                  <use xlink:href="#icon-data-quality_16"></use>
                </svg>
              </button>
              </div>

            </div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Channel
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.channel}}
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            MSP ID
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.mspID}}
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Certificate Authority (CA)
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.ca}}
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Peer(s)
          </div>
          <div class="profile-value">
            <div class="nested-section" *ngFor="let peer of connectionProfileData.profile.peers">
              <div class="nested-row">
                <div class="nested-property">Peer Request URL</div>
                <div class="nested-value">{{peer.requestURL}}</div>
                <button type="button" class="certificate-button" (click)="showCertificate(peer.cert,peer.hostnameOverride)">
                <svg class="standard-icon" aria-hidden="true">
                  <use xlink:href="#icon-data-quality_16"></use>
                </svg>
              </button>
              </div>
              <div class="nested-row">
                <div class="nested-property">Peer Event URL</div>
                <div class="nested-value">{{peer.eventURL}}</div>
              </div>
            </div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Key Value Store Directory
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.keyValStore}}
          </div>
        </div>
      </div>
    </div>
    <div class="profile-data-header">
      <div class="section-details">
        <div class="section-name" (click)="expandSection('Advanced')">
          Advanced
        </div>
        <div class="section-expand">
          <button type="button" class="action" (click)="expandSection('Advanced')">
            <svg [ngClass]="{'chevron': expandedSection.indexOf('Advanced') < 0}" class="standard-icon" *ngIf="showExpand" aria-hidden="true">
              <use xlink:href="#icon-chevron-down"></use>
            </svg>
          </button>
        </div>
      </div>
      <div class="data-section" [ngClass]="{'expanded' : expandedSection.indexOf('Advanced') > -1}">
        <div class="profile-row">
          <div class="profile-property">
            Deploy Wait Time (seconds)
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.deployWaitTime}}
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Invoke Wait Time (seconds)
          </div>
          <div class="profile-value">
            {{connectionProfileData.profile.invokeWaitTime}}
          </div>
        </div>
      </div>
    </div>
  </div>



  <button *ngIf="!editing" class="button primary" type="button" (click)="useProfile()">Use this profile</button>
  <button *ngIf="!editing && connectionProfileData.name !== '$default'" class="button secondary" type="button" (click)="exportProfile()">
    <svg class="standard-icon" aria-hidden="true">
      <use xlink:href="#icon-upload_32"></use>
    </svg>
    Export Connection Profile
  </button>



  <!-- EDIT V0.6 CONNECTION PROFILE -->

  <div *ngIf="connectionProfileData.profile.type === 'hlf' && editing" class="edit-data">
    <form [formGroup]="v06Form" (ngSubmit)="onSubmit()">
      <section>
        <div class="section-title">Basic Configuration</div>
        <div class="profile-row">
          <div class="profile-property">
            Connection Profile Name*
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v06FormErrors.name}" type="text" formControlName="name">
            <div *ngIf="v06FormErrors.name" class="error-message">
              {{ v06FormErrors.name }}
            </div>
          </div>
        </div>

        <div class="profile-row">
          <div class="profile-property">
            Profile Description
          </div>
          <div class="profile-value">
            <textarea formControlName="description" rows="4"></textarea>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Peer URL*
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v06FormErrors.peerURL}" type="text" formControlName="peerURL">
            <div *ngIf="v06FormErrors.peerURL" class="error-message">
              {{ v06FormErrors.peerURL }}
            </div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Membership Services URL*
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v06FormErrors.membershipServicesURL}" type="text" formControlName="membershipServicesURL">
            <div *ngIf="v06FormErrors.membershipServicesURL" class="error-message">
              {{ v06FormErrors.membershipServicesURL }}
            </div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Event Hub URL*
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v06FormErrors.eventHubURL}" type="text" formControlName="eventHubURL">
            <div *ngIf="v06FormErrors.eventHubURL" class="error-message">
              {{ v06FormErrors.eventHubURL }}
            </div>
          </div>
        </div>

        <div class="profile-row">
          <div class="profile-property">
            Key Value Store Directory Path*
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v06FormErrors.keyValStore}" type="text" formControlName="keyValStore">
            <div *ngIf="v06FormErrors.keyValStore" class="error-message">
              {{ v06FormErrors.keyValStore }}
            </div>
          </div>
        </div>
      </section>
      <section>
        <div class="section-title">Security Settings</div>
        <div class="profile-row">
          <div class="profile-property">
            Certificate
          </div>
          <div class="profile-value">
            <input type="text" formControlName="certificate">
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Certificate Path
          </div>
          <div class="profile-value">
            <input type="text" formControlName="certificatePath">
          </div>
        </div>
        <div class="section-title">Advanced</div>
        <div class="profile-row">
          <div class="profile-property">
            Deploy Wait Time (seconds)
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v06FormErrors.deployWaitTime}" type="text" formControlName="deployWaitTime">
            <div *ngIf="v06FormErrors.deployWaitTime" class="error-message">
              {{ v06FormErrors.deployWaitTime }}
            </div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Invoke Wait Time (seconds)
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v06FormErrors.invokeWaitTime}" type="text" formControlName="invokeWaitTime">
            <div *ngIf="v06FormErrors.invokeWaitTime" class="error-message">
              {{ v06FormErrors.invokeWaitTime }}
            </div>
          </div>
        </div>
      </section>
      <footer>
        <div class="info"></div>
        <button class="secondary" (click)="stopEditing()">Cancel</button>
        <button class="primary" type="submit" [disabled]="!v06Form.valid">Save</button>
      </footer>
    </form>
  </div>



  <!-- EDIT V1 CONNECTION PROFILE -->

  <div *ngIf="connectionProfileData.profile.type === 'hlfv1' && editing" class="edit-data">
    <form [formGroup]="v1Form" (ngSubmit)="onSubmit()">
      <section>
        <div class="section-title">Basic Configuration</div>
         <div class="profile-row">
          <div class="profile-property">
            Connection Profile Name*
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v1FormErrors.name}" type="text" formControlName="name">
            <div *ngIf="v1FormErrors.name" class="error-message">
              {{ v1FormErrors.name }}
            </div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Profile Description
          </div>
          <div class="profile-value">
            <textarea formControlName="description" rows="4"></textarea>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Orderer(s)*
          </div>
          <div class="profile-value margin-right">
            <div formArrayName="orderers" *ngFor="let orderer of v1Form.controls.orderers.controls; let i=index">
              <div class="profile-row" [formGroupName]="i">
                  <div class="profile-value margin-right">
                    <input [ngClass]="{'error-underline': v1FormErrors.orderers.url}" class="margin-right" type="text" formControlName="url">
                    <div *ngIf="v1FormErrors.orderers.url" class="error-message">
                      {{ v1FormErrors.orderers.url }}
                    </div>
                    <input hidden type="text" formControlName="cert">
                    <input hidden type="text" formControlName="hostnameOverride">
                  </div>
                  <button type="button" [ngClass]="{'certificate-button':true, 'no-cert': v1Form.controls.orderers.controls[i].value.cert === ''}" (click)="openAddCertificateModal(i,'orderers');">
                    <svg class="standard-icon" aria-hidden="true">
                      <use xlink:href="#icon-data-quality_16"></use>
                    </svg>
                  </button>
              </div>
            </div>


            <div *ngIf="v1FormErrors.orderers.cert" class="error-message">
              {{ v1FormErrors.orderers.cert }}
            </div>
            <div *ngIf="v1FormErrors.orderers.hostnameOverride" class="error-message">
              {{ v1FormErrors.orderers.hostnameOverride }}
            </div>
          </div>

          <div class="profile-buttons">
            <button type="button" class="secondary" (click)="addOrderer()">+ Add another</button>
            <button type="button" class="secondary" *ngIf="v1Form.controls.orderers.controls.length > 1" (click)="removeOrderer((v1Form.controls.orderers.controls.length - 1))">Remove orderer</button>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Channel*
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v1FormErrors.channel}" type="text" formControlName="channel">
            <div *ngIf="v1FormErrors.channel" class="error-message">
              {{ v1FormErrors.channel }}
            </div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            MSP ID*
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v1FormErrors.mspID}" type="text" formControlName="mspID">
            <div *ngIf="v1FormErrors.mspID" class="error-message">
              {{ v1FormErrors.mspID }}
            </div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Certificate Authority (CA)*
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v1FormErrors.ca}" type="text" formControlName="ca">
            <div *ngIf="v1FormErrors.ca" class="error-message">
              {{ v1FormErrors.ca }}
            </div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-property">
            Peer(s)*
          </div>
          <div class="profile-value margin-right">
            <div formArrayName="peers" class="nested-group" *ngFor="let peer of v1Form.controls.peers.controls; let i=index">
              <div class="nested-section" [formGroupName]="i">
                <div class="nested-row">
                  <div class="nested-property">
                    Peer Request URL*
                  </div>
                  <div class="nested-value margin-right">
                    <input [ngClass]="{'error-underline': v1FormErrors.requestURL}" type="text" formControlName="requestURL">
                    <div *ngIf="v1FormErrors.peers.requestURL" class="error-message">
                      {{ v1FormErrors.peers.requestURL }}
                    </div>
                  </div>
                  <button type="button" [ngClass]="{'certificate-button':true, 'no-cert': v1Form.controls.peers.controls[i].value.cert === ''}" (click)="openAddCertificateModal(i,'peers');">
                    <svg class="standard-icon" aria-hidden="true">
                      <use xlink:href="#icon-data-quality_16"></use>
                    </svg>
                  </button>

                </div>
                <div class="nested-row">
                  <div class="nested-property">
                    Peer Event URL*
                  </div>
                  <div class="nested-value">
                    <input [ngClass]="{'error-underline': v1FormErrors.peers.eventURL}" class="margin-right" type="text" formControlName="eventURL">
                    <div *ngIf="v1FormErrors.peers.eventURL" class="error-message">
                      {{ v1FormErrors.peers.eventURL }}
                    </div>

                    <input hidden type="text" formControlName="cert">
                    <input hidden type="text" formControlName="hostnameOverride">
                  </div>
                </div>
              </div>
            </div>

          </div>
          <div class="profile-buttons">
            <button type="button" class="secondary" (click)="addPeer()">+ Add another</button>
            <button type="button" class="secondary" *ngIf="v1Form.controls.peers.controls.length > 1" (click)="removePeer((v1Form.controls.orderers.controls.length - 1))">Remove Peer</button>
          </div>
        </div>



        <div class="profile-row">
          <div class="profile-property">
            Key Value Store Directory Path*
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v1FormErrors.keyValStore}" type="text" formControlName="keyValStore">
            <div *ngIf="v1FormErrors.keyValStore" class="error-message">
              {{ v1FormErrors.keyValStore }}
            </div>
          </div>
        </div>

      </section>
      <section>
        <div class="section-title">Advanced</div>
        <div class="profile-row">
          <div class="profile-property">
            Deploy Wait Time (seconds)
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v1FormErrors.deployWaitTime}" type="text" formControlName="deployWaitTime">
            <div *ngIf="v1FormErrors.deployWaitTime" class="error-message">
              {{ v1FormErrors.deployWaitTime }}
            </div>
          </div>
        </div>

        <div class="profile-row">
          <div class="profile-property">
            Invoke Wait Time (seconds)
          </div>
          <div class="profile-value">
            <input [ngClass]="{'error-underline': v1FormErrors.invokeWaitTime}" type="text" formControlName="invokeWaitTime">
            <div *ngIf="v1FormErrors.invokeWaitTime" class="error-message">
              {{ v1FormErrors.invokeWaitTime }}
            </div>
          </div>
        </div>

      </section>
      <footer>
        <div class="info"></div>
        <button class="secondary" (click)="stopEditing()">Cancel</button>
        <button class="primary" type="submit" [disabled]="!v1Form.valid">Save</button>
      </footer>
    </form>
  </div>
</div>

